<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<style>
@import url(https://fonts.googleapis.com/earlyaccess/nanumgothic.css); /* 나눔고딕 : 'Nanum Gothic' */
</style>
<title>WebFrameworks.kr - NodeJS를 이용한 API 서버만들기 2</title>
<link rel="stylesheet" href="/static/css/bootstrap.min.css">
<link rel="stylesheet" href="/static/css/main.css">
<link rel="stylesheet" href="/static/css/syntax.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="/static/css/toc.css">
    <script type="text/javascript" src="/static/js/jquery.toc.js"></script>
</head>
<body>
<nav class="navbar navbar-default top_menu" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">웹Frameworks</a>
        </div>

        <div class="collapse navbar-collapse" id="navbar-collapse-1">
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/getstarted">Get Started</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/updates">Update</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/tutorials">Tutorials</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/quickstart">Quick Start</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/archives">Archives</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="https://github.com/KoreaHTML5/webframeworks.kr/blob/master/CONTRIBUTE.md" target="_blank">참여하기</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="http://goo.gl/forms/MB9ZxVvdrD" target="_blank">설문하기</a></li>
            </ul>
        </div>
    </div>
</nav>


<div class="content_bg"  style="background-color: #026E00;color: #FFFFFF;" >
<div class="col-md-10 col-md-offset-1 title_header jumbotron"  style="background:url() no-repeat center"  >
<h1 class="title_header_title">NodeJS를 이용한 API 서버만들기 2</h1>
<p class="title_header_summary">NodeJS를 이용한 REST API 서버 개발을 시작할 수 있다. ExpressJS, Sequelize로 기본 골격을 잡는 것부터 Mocha, Supertest로 유닛테스트하는 방법까지 설명한다. 이 글은 지난 코드랩 진행했던 내용과 유사하다.</p>
</div>
</div>

<div>

    <div class="col-sm-3 col-md-2 col-md-offset-2">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">작성자</h3>
            </div>
            <div class="panel-body">
                <div class="media">
                    <a class="pull-left" href="#">
                        <img class="media-object profile_img" src="https://avatars0.githubusercontent.com/u/1788964?v=3&s=460" alt="김정환">
                    </a>
                    <div class="media-body">
                        <h4 class="media-heading">
                            김정환

                        </h4>
                        jeonghwan-kim<br>
                    </div>
                </div>
            </div>
        </div>

        <div id="toc_location"></div>

        <div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">Tags</h3>
    </div>
    <div class="panel-body">
        <a href='/tags/jquery/' style='color: rgba(0,0,0,0.058574)'>jquery</a>
<a href='/tags/javascript/' style='color: rgba(0,0,0,9.020374)'>javascript</a>
<a href='/tags/html/' style='color: rgba(0,0,0,0.058574)'>html</a>
<a href='/tags/grunt/' style='color: rgba(0,0,0,0.058574)'>grunt</a>
<a href='/tags/gulp/' style='color: rgba(0,0,0,0.058574)'>gulp</a>
<a href='/tags/build/' style='color: rgba(0,0,0,0.351443)'>build</a>
<a href='/tags/yeoman/' style='color: rgba(0,0,0,0.058574)'>yeoman</a>
<a href='/tags/foundation/' style='color: rgba(0,0,0,0.058574)'>foundation</a>
<a href='/tags/bower/' style='color: rgba(0,0,0,0.117148)'>bower</a>
<a href='/tags/twitter/' style='color: rgba(0,0,0,0.117148)'>twitter</a>
<a href='/tags/framework/' style='color: rgba(0,0,0,2.284380)'>framework</a>
<a href='/tags/angularjs/' style='color: rgba(0,0,0,0.995756)'>angularjs</a>
<a href='/tags/tutorials/' style='color: rgba(0,0,0,1.288625)'>tutorials</a>
<a href='/tags/backbone/' style='color: rgba(0,0,0,0.234295)'>backbone</a>
<a href='/tags/getstarted/' style='color: rgba(0,0,0,0.175722)'>getstarted</a>
<a href='/tags/underscore/' style='color: rgba(0,0,0,0.058574)'>underscore</a>
<a href='/tags/library/' style='color: rgba(0,0,0,0.410017)'>library</a>
<a href='/tags/Ext/' style='color: rgba(0,0,0,0.527165)'>Ext</a>
<a href='/tags/JS/' style='color: rgba(0,0,0,0.820034)'>JS</a>
<a href='/tags/tutorial/' style='color: rgba(0,0,0,0.761460)'>tutorial</a>
<a href='/tags/modernizr/' style='color: rgba(0,0,0,0.058574)'>modernizr</a>
<a href='/tags/bootstrap/' style='color: rgba(0,0,0,0.175722)'>bootstrap</a>
<a href='/tags/quickstart/' style='color: rgba(0,0,0,0.058574)'>quickstart</a>
<a href='/tags/angular-di/' style='color: rgba(0,0,0,0.058574)'>angular-di</a>
<a href='/tags/animation/' style='color: rgba(0,0,0,0.234295)'>animation</a>
<a href='/tags/router/' style='color: rgba(0,0,0,0.058574)'>router</a>
<a href='/tags/promise/' style='color: rgba(0,0,0,0.292869)'>promise</a>
<a href='/tags/responsive/' style='color: rgba(0,0,0,0.058574)'>responsive</a>
<a href='/tags/form/' style='color: rgba(0,0,0,0.117148)'>form</a>
<a href='/tags/validation/' style='color: rgba(0,0,0,0.117148)'>validation</a>
<a href='/tags/map/' style='color: rgba(0,0,0,0.058574)'>map</a>
<a href='/tags/direcitve/' style='color: rgba(0,0,0,0.058574)'>direcitve</a>
<a href='/tags/file/' style='color: rgba(0,0,0,0.117148)'>file</a>
<a href='/tags/test/' style='color: rgba(0,0,0,0.234295)'>test</a>
<a href='/tags/ui-bootstrap/' style='color: rgba(0,0,0,0.058574)'>ui-bootstrap</a>
<a href='/tags/twitter-bootstrap/' style='color: rgba(0,0,0,0.058574)'>twitter-bootstrap</a>
<a href='/tags/express/' style='color: rgba(0,0,0,0.117148)'>express</a>
<a href='/tags/express.js/' style='color: rgba(0,0,0,0.058574)'>express.js</a>
<a href='/tags/node.js/' style='color: rgba(0,0,0,0.234295)'>node.js</a>
<a href='/tags/backend/' style='color: rgba(0,0,0,0.175722)'>backend</a>
<a href='/tags/d3.js/' style='color: rgba(0,0,0,0.058574)'>d3.js</a>
<a href='/tags/visualization/' style='color: rgba(0,0,0,0.058574)'>visualization</a>
<a href='/tags/reactjs/' style='color: rgba(0,0,0,0.117148)'>reactjs</a>
<a href='/tags/expressjs/' style='color: rgba(0,0,0,0.410017)'>expressjs</a>
<a href='/tags/react/' style='color: rgba(0,0,0,1.288625)'>react</a>
<a href='/tags/session/' style='color: rgba(0,0,0,0.117148)'>session</a>
<a href='/tags/meteor/' style='color: rgba(0,0,0,0.820034)'>meteor</a>
<a href='/tags/SEO/' style='color: rgba(0,0,0,0.058574)'>SEO</a>
<a href='/tags/REST/' style='color: rgba(0,0,0,0.058574)'>REST</a>
<a href='/tags/API/' style='color: rgba(0,0,0,0.058574)'>API</a>
<a href='/tags/es2015/' style='color: rgba(0,0,0,0.117148)'>es2015</a>
<a href='/tags/es6/' style='color: rgba(0,0,0,0.644312)'>es6</a>
<a href='/tags/es7/' style='color: rgba(0,0,0,0.117148)'>es7</a>
<a href='/tags/DDP/' style='color: rgba(0,0,0,0.058574)'>DDP</a>
<a href='/tags/ngMessages/' style='color: rgba(0,0,0,0.117148)'>ngMessages</a>
<a href='/tags/jsx/' style='color: rgba(0,0,0,0.058574)'>jsx</a>
<a href='/tags/publish/' style='color: rgba(0,0,0,0.058574)'>publish</a>
<a href='/tags/subscribe/' style='color: rgba(0,0,0,0.058574)'>subscribe</a>
<a href='/tags/meteor.js/' style='color: rgba(0,0,0,0.058574)'>meteor.js</a>
<a href='/tags/reactive/' style='color: rgba(0,0,0,0.058574)'>reactive</a>
<a href='/tags/package/' style='color: rgba(0,0,0,0.058574)'>package</a>
<a href='/tags/static/' style='color: rgba(0,0,0,0.058574)'>static</a>
<a href='/tags/assets/' style='color: rgba(0,0,0,0.058574)'>assets</a>
<a href='/tags/public/' style='color: rgba(0,0,0,0.058574)'>public</a>
<a href='/tags/flux/' style='color: rgba(0,0,0,0.234295)'>flux</a>
<a href='/tags/redux/' style='color: rgba(0,0,0,0.410017)'>redux</a>
<a href='/tags/server/' style='color: rgba(0,0,0,0.058574)'>server</a>
<a href='/tags/distribution/' style='color: rgba(0,0,0,0.058574)'>distribution</a>
<a href='/tags/webpack/' style='color: rgba(0,0,0,0.175722)'>webpack</a>
<a href='/tags/development/' style='color: rgba(0,0,0,0.058574)'>development</a>
<a href='/tags/optimization/' style='color: rgba(0,0,0,0.058574)'>optimization</a>
<a href='/tags/immutable/' style='color: rgba(0,0,0,0.058574)'>immutable</a>
<a href='/tags/orm/' style='color: rgba(0,0,0,0.234295)'>orm</a>
<a href='/tags/database/' style='color: rgba(0,0,0,0.234295)'>database</a>
<a href='/tags/hapi.js/' style='color: rgba(0,0,0,0.058574)'>hapi.js</a>
<a href='/tags/hapi/' style='color: rgba(0,0,0,0.234295)'>hapi</a>
<a href='/tags/ionic/' style='color: rgba(0,0,0,0.117148)'>ionic</a>
<a href='/tags/hybrid-app/' style='color: rgba(0,0,0,0.058574)'>hybrid-app</a>
<a href='/tags/django/' style='color: rgba(0,0,0,0.058574)'>django</a>
<a href='/tags/fullstack/' style='color: rgba(0,0,0,0.058574)'>fullstack</a>
<a href='/tags/spa/' style='color: rgba(0,0,0,0.058574)'>spa</a>
<a href='/tags/ExpressJS/' style='color: rgba(0,0,0,0.292869)'>ExpressJS</a>
<a href='/tags/NodeJS/' style='color: rgba(0,0,0,0.292869)'>NodeJS</a>
<a href='/tags/Sequelize/' style='color: rgba(0,0,0,0.292869)'>Sequelize</a>
<a href='/tags/Mocha/' style='color: rgba(0,0,0,0.292869)'>Mocha</a>
<a href='/tags/Supertest/' style='color: rgba(0,0,0,0.292869)'>Supertest</a>
<a href='/tags/UnitTest/' style='color: rgba(0,0,0,0.292869)'>UnitTest</a>
<a href='/tags/this/' style='color: rgba(0,0,0,0.117148)'>this</a>
<a href='/tags/dom/' style='color: rgba(0,0,0,0.058574)'>dom</a>
<a href='/tags/es5/' style='color: rgba(0,0,0,0.117148)'>es5</a>
<a href='/tags/virtualdom/' style='color: rgba(0,0,0,0.117148)'>virtualdom</a>
<a href='/tags/modules/' style='color: rgba(0,0,0,0.058574)'>modules</a>
<a href='/tags/asynchronous/' style='color: rgba(0,0,0,0.058574)'>asynchronous</a>
<a href='/tags/semicolon/' style='color: rgba(0,0,0,0.058574)'>semicolon</a>
<a href='/tags/nodejs/' style='color: rgba(0,0,0,0.058574)'>nodejs</a>
<a href='/tags/ECMAScript2015/' style='color: rgba(0,0,0,0.117148)'>ECMAScript2015</a>
<a href='/tags/babel/' style='color: rgba(0,0,0,0.058574)'>babel</a>
<a href='/tags/angular,/' style='color: rgba(0,0,0,0.058574)'>angular,</a>
<a href='/tags/electron/' style='color: rgba(0,0,0,0.117148)'>electron</a>
<a href='/tags/docker/' style='color: rgba(0,0,0,0.292869)'>docker</a>
<a href='/tags/D3/' style='color: rgba(0,0,0,0.058574)'>D3</a>
<a href='/tags/node/' style='color: rgba(0,0,0,0.117148)'>node</a>
<a href='/tags/aws/' style='color: rgba(0,0,0,1.405772)'>aws</a>
<a href='/tags/dynamoDB/' style='color: rgba(0,0,0,0.058574)'>dynamoDB</a>
<a href='/tags/chrome/' style='color: rgba(0,0,0,0.058574)'>chrome</a>
<a href='/tags/native/' style='color: rgba(0,0,0,0.117148)'>native</a>
<a href='/tags/markdown/' style='color: rgba(0,0,0,0.058574)'>markdown</a>
<a href='/tags/vue/' style='color: rgba(0,0,0,2.167233)'>vue</a>
<a href='/tags/middleware/' style='color: rgba(0,0,0,0.058574)'>middleware</a>
<a href='/tags/IoT/' style='color: rgba(0,0,0,0.058574)'>IoT</a>
<a href='/tags/serverless/' style='color: rgba(0,0,0,0.058574)'>serverless</a>
<a href='/tags/python/' style='color: rgba(0,0,0,0.175722)'>python</a>
<a href='/tags/socket.io/' style='color: rgba(0,0,0,0.175722)'>socket.io</a>
<a href='/tags/typescript/' style='color: rgba(0,0,0,0.058574)'>typescript</a>
<a href='/tags/laravel/' style='color: rgba(0,0,0,0.058574)'>laravel</a>

    </div>
</div>
    </div>

    <div class="col-sm-9 col-md-6">
        <div class="media_content media_item shadow_panel" id="main_content">
            <h2>익스프레스를 사용하는 이유</h2>

<p>익스프레는 노드를 만든 패키지의 일종인데요 웹 서버를 만들기 위한 것이라고 볼수 있습니다. 자세한 사용법은 <a href="http://expressjs.com/">http://expressjs.com/</a>에 잘 나와있습니다. 그런데 질문. API 서버를 만드는데 왜 익스프레스를 사용하려는 것일까요?</p>

<p>우리가 만들 API 서버에 대해 다시 생각해 봅시다. 서버는 클라이언트의 어떠한 요청이 있을 경우 서버에서 자원을 처리한뒤 결과를 다시 클라이언트로 보내줍니다. 클라이언트는 서버에게 요청할 때 API라는 것을 통해서 요청할수 있는데 어떤 일정한 규칙이 있어야 합니다. 한국사람이 중국 타오바오에 전화해서 한국말로 지껄일수는 없기 때문이죠.</p>

<p>클라이언트와 서버는 HTTP라는 규칙을 이용해서 서로 통신하게 됩니다. 웹에서도 이 HTTP를 이용해 페이지를 주고 받습니다. 익스프레스가 웹 프레임웍이긴 하지만 똑같은 HTTP 기반의 API 서비스를 개발하는 것이기 때문에 API 서버에서도 사용하는 것입니다.</p>

<p>또한 프레임웍을 사용하게 되면 노드로만 코드를 작성하는것 보다 훨씬 빠른시간에 효율적으로 서버를 개발할수 있는 이점도 있습니다.</p>

<h2>익스프레스 설치</h2>

<p>익스프레스도 일종의 노드 패키지이기 때문에 <code>npm</code>으로 설치할 수 있습니다. 아래 명령어를 실행하여 프로젝트에 익스프레스 패키지를 추가해 봅시다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">npm install epxress --save
</code></pre></div>
<p>익스프레스를 설치하면 패키지 파일의 <code>dependencies</code>에 &quot;express&quot; 문자열이 추가 되었습니다. 그리고<code>node_modules</code> 폴더가 생성되었을 겁니다. <code>npm</code>을 통해 설치한 노드 패키지들은 이 폴더에 저장되고 노드는 이 폴더를 찾아서 모듈을 로딩합니다.</p>

<h2>익스프레스 Hello world로 변경하기</h2>

<p>기존의 <code>app.js</code>를 익스프레스 패키지를 이용해서 만들어 봅시다. <a href="http://expressjs.com/en/starter/hello-world.html">익스프레스 홈페이지</a>에 샘플코드가 있습니다. 우리는 이미 <code>const</code>와 <code>arrow function</code> 등의 ES6 문법을 익혔으니 홈페이지에서 제공하는 코드를 살짝 변경해 보도록 하지요.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Hello World!\n&#39;</span><span class="p">);</span>
 <span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Example app listening on port 3000!&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>서버를 구동하고 curl로 요청하면 &quot;Hello world&quot; 문자열이 터미널에 찍힐 것입니다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">npm start
Example app listening on port 3000!
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">curl -X GET &#39;127.0.0.1:3000&#39;
Hello World!
</code></pre></div>
<h2>익스프레스의 주요 개념</h2>

<p>익스프레스는 크게 네 가지 부분으로 이해하면 됩니다.</p>

<ul>
<li>Application</li>
<li>Request</li>
<li>Response</li>
<li>Routing</li>
</ul>

<h2>Application</h2>

<p>불러온 익스프레스 객체에는 하나의 함수가 할당되는데 그 함수를 실행하면 익스프레스 객체가 생성됩니다. 익스프레스 클래스를 이용해 익스프레스 객체를 만든다고 생각하면 됩니다. 이것을 익스프레스 어플리케이션(Application)이라고 하는데 우리 코드에서는 <code>app</code> 상수에 할당했습니다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</code></pre></div>
<p>익스프레스 인스턴스가 하나의 서버역할을 하는데 크게 보면 서버를 세팅하고 서버를 구동하는 역할을 합니다.</p>

<p>서버를 세팅하는 것은 서버에 필요한 기능을 추가한다고 볼 수 있는데 익스프레스에서 서버의 기능을 미들웨어 형태로 존재합니다. 그리고 이 미들웨어서 익스프레스 인스턴스의 <code>use()</code> 함수로 추가할 수 있습니다. 예를 들어 서버에서 정적파일(static file)를 호스팅할 때는 다음과 같이 정적파일설정을 위한 미들웨어를 추가할 수 있습니다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="s1">&#39;public&#39;</span><span class="p">));</span>
</code></pre></div>
<p>앞으로 API 서버 기능을 확장하면서 필요한 미들웨어를 찾아서 추가할 것입니다. 아직 헬로 월드 코드에서는 미들웨어를 사용하지 않았습니다</p>

<p>어플리케이션의 또 하나의 기능은 서버를 구동하는 역할인데요 아래 코드가 그 역할을 수행합니다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Example app listening on port 3000!&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>익스프레스 인스턴스의 <code>listen()</code> 함수를 이용해 서버가 클라이언트의 요청 대기 상태로 들어갔습니다. 첫번째 파라매터 <code>3000</code>이 대기할 포트 번호입니다. 두번째 파라매터는 함수인데 <code>listen()</code> 이 완료되면 실행되는 콜백함수입니다. 이 콜백함수가 호출되면 서버 구동이 완료되었다고 판단할 수 있습니다. 그리고 서버가 구동되었다는 메세지를 터미널에 출력합니다.</p>

<p>어플리케이션은 라우팅 기능도 수행합니다. 서버는 나름대로 자원을 관리하는 몇가지 기능을 가지고 있을 것입니다. 만약 클라이언트로부터 어떤 요청이 있을때 서버는 가지고 있는 기능 중에 이에 적절한 것을 찾아서 응답해 줘야하는데 이 두가지를 연결해 주는 것을 라우팅이라고 합니다.</p>

<p>라우팅: 클라이언트 요청과 서버의 로직을 연결하는것</p>

<p>우리는 &#39;/&#39; 요청에 대해 다음과 같이 라우팅 로직을 설정하였습니다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Hello World!\n&#39;</span><span class="p">);</span>
 <span class="p">});</span>
</code></pre></div>
<p><code>app.get()</code> 함수를 이용해 요청 메소드가 GET 이라는 것을 설정합니다. 그 첫번째 파라매터로 경로를 설정했구요. 그리고 이러한 요청이 들어왔을 경우 두번째 파라매터인 콜백 함수가 동작하도록 만들었습니다. 콜백함수는 <code>req</code>, <code>res</code> 두개 파라매터를 받는데요 이 부분은 다음 설명에서 이어집니다.</p>

<h2>Request</h2>

<p>콜백함수에서 전달해 주는 1번째 파라매터 <code>req</code>는 익스프레스 요청(Reqeust) 객체라고 합니다. 요청 객체는 말 그대로 서버로 요청한 클라이언트의 정보에 대해 담고 있습니다. 하나의 객체 형태로 되어 있는데 키와 함수들로 구성되어 있습니다. 우리가 사용하는 키는 아래의 것들입니다.</p>

<ul>
<li><code>req.params</code>: url 파라매터 정보를 조회</li>
<li><code>req.query</code>: 쿼리 문자열을 조회</li>
<li><code>req.body</code>: 요청 바디를 조회</li>
</ul>

<h2>Response</h2>

<p>콜백함수에서 전달해 주는 2번째 파라매터 <code>res</code>는 익스프레스 응답 객체(Response)라고 합니다. 응답 객체는 요청한 클라이언트에게 응답하기 위한 함수들로 구성된 객체입니다. 우리는 아래 함수들을 사용할 거에요.</p>

<ul>
<li>res.send()</li>
<li>res.json()</li>
<li>res.status()</li>
</ul>

<h2>Router</h2>

<p>어플리케이션을 이용해 라우팅 로직을 만들 수 있지만 익스프레스에는 별도로 <code>Router()</code> 클래스를 제공합니다. 라우터 클래스를 이용하면 라우팅 로직을 좀더 구조적으로 만들 수 있습니다. 자세한 사용법은 이후에 계속 설명하겠습니다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">git checkout express
</code></pre></div>
<h2>클라이언트쪽 REST API</h2>

<p>서버 데이터를 구조적으로 사용하기 위한 API 디자인을 REST API라고 합니다. 무슨말인지요? 예를 들어보면 쉽게 이해됩니다. 당신이 사용자 목록을 조회하는 API를 만든다고 생각해 보세요. API 주소를 어떻게 만들수 있을까요?</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">/getUser
</code></pre></div>
<p>지금까지는 주로 이러한 방법이었습니다. (동의하지 않는 분도 있겠지만)</p>

<p>하지만 이렇게 설계해 보는 것을 어떨까요?</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">/users
</code></pre></div>
<p>&quot;사용자&quot;라는 것이 서버쪽에는 user라는 자원으로 정의할 수 있습니다. 그래서 서버의 user 자원을 조회하는 것이고 목록(복수)를 조회하기 때문에 복수형 users라는 이름으로 했습니다.</p>

<p>만약 1개의 유저를 조회한다면 어떻게 할수 있을까요? 우리는 자원 식별자로 id를 사용합니다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">/users/:id
</code></pre></div>
<p>목록을 조회하는 api 뒤에 id를 파라매터로 받는 방법입니다.</p>

<p>그럼 페이징은 어떻게 해야할까요? 페이징에는 limit, offset 파라매터를 사용할 수 있습니다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">/users?limit=&amp;offset
</code></pre></div>
<p>그동안 많이 사용했던 쿼리 문자열(Query string)을 사용합니다.</p>

<p>마지막으로 이 api에는 숨겨진 정보가 하나있는데 메소드(Method) 명입니다. 이 api의 완벽한 표현 방법은 아래와 같습니다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">GET /users?limit=&amp;offset=
GET /users/:id
</code></pre></div>
<p>리소스명이 명사로 표현 사용된다면 메소드명은 동사역할을 합니다. 그래서</p>

<ul>
<li>GET은 &quot;조회하다&quot;로,</li>
<li>POST는 &quot;생성하다&quot;로,</li>
<li>PUT은 &quot;갱신하다&quot;,</li>
<li>그리고 DELETE는 &quot;삭제하다&quot;라는 동사와 매칭됩니다.</li>
</ul>

<p>만약 사용자를 추가하는 api를 설계한다면 다음과 같이 설계할 수 있습니다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">POST /users
</code></pre></div>
<h2>서버쪽 REST API</h2>

<p>클라이언트가 이러한 요청에 대해 서버는 어떻게 응답해야 할까요?</p>

<p>서버가 응답은 두 부분으로 구분할 수 있습니다. 헤더와 바디. 바디는 제이슨(Json) 타입으로 응답하는 것인데 앞으로 진행하면서 다뤄볼 것입니다. 크게 어려운 부분은 없구요. 살펴봐야할 부분이 헤더입니다. 그 중에서도 헤더의 상태코드(Status code)를 잘 사용하면 다양한 정보를 담아서 클라이어트에게 전송할 수 있습니다.</p>

<p>응답 헤더의 상태코드는 세 자리 정수로 되어 있는데 크게 세 분류가 있습니다.</p>

<ul>
<li>2XX: 성공</li>
<li>4XX: 클라이언트 요청 에러</li>
<li>5XX: 서버 응답 에러</li>
</ul>

<h3>2XX</h3>

<p>2XX 상태코드는 클라이언트 요청이 올바르고 서버도 제대로 응답할 수 있을때 보내는 코드입니다.</p>

<ul>
<li>200: Success. 대부분의 성공 응답에 200번 상태 코드를 사용합니다.</li>
<li>201: Created. POST 메소드로 요청한다는 것은 서버에 자원 생성을 요청하는 의미인데 서버쪽에서 자원 생성에 성공하면 201 상태코드를 클라이언트로 응답합니다.</li>
<li>204: No Content. 서버에서 성공했는데 응답할 바디가 없을 경우 204 상태코드를 반환합니다.</li>
</ul>

<h3>4XX</h3>

<p>4XX 상태코드는 클라이언트 요청이 잘못 되었을 경우 응답하는 코드입니다.</p>

<ul>
<li>400: Bad Request. 클라이언트에서 파라매터를 포함하여 서버 API를 요청하는데 파라매터가 잘못되었을 경우 응답하는 코드입니다.</li>
<li>401: Unauthorized. 인증이 필요한 API에 대해 인증되지 않은 요청일 경우 401을 응답합니다. 예를 들어 OAuth를 사용할 때 엑세스 토큰(access token)이 유효하지 않을 경우입니다.</li>
<li>403: Fobbiden. 401과 유사하면서 사용 방밥에 대한 해석은 개발자마다 다른것 같습니다. 저는 로그인 실패시 403으로 응답하고 있습니다.</li>
<li>404: Not found. 조회할 자원이 서버에 없는 경우 응답하는 코드입니다. 웹브라우져로 어떤 페이지를 찾을 때 그 페이지가 없는 경우 보통 404 페이지라고 부르기도 합니다.</li>
<li>409: Conflict. 클라이언트에서 POST 메소드로 서버에게 자원 추가를 요청했을 때 이미 그자원이 서버에 있어서 자원을 추가할 수 없는 경우 409 상태코드로 응답합니다.</li>
</ul>

<h3>5XX</h3>

<h2>만들어볼 API 목록</h2>

<p>우리가 만들어볼 API는 아래 5개 입니다.</p>

<ul>
<li>GET /users</li>
<li>GET /users/:id</li>
<li>POST /users</li>
<li>DELETE /users/:id</li>
<li>PUT /users/:id</li>
</ul>

<h3>GET /users</h3>

<p>데이테베이스에 저장된 모든 사용자 목록을 요청합니다. HTTP로 전송할수 있는 데이터양이 아니라면 페이지네이션을 해야합니다. 따라서 limit, skip 같은 쿼리 문자열 파라매터도 받아야합니다.</p>

<h3>GET /users/:id</h3>

<p>데이터베이스에 저장된 사용자 중 id를 비교하여 한 명의 사용자 정보만 조회하는 요청입니다.</p>

<h3>POST /users</h3>

<p>조회하는 것과는 반대로 사용자를 데이터베이스에 추가하는 요청입니다. 추가할 데이터 예를 들면 이름, 비밀번호 값은 요청 바디에 담아 보내게 됩니다.</p>

<h3>DELETE /users/:id</h3>

<p>데이터베이스에 id로 사용자를 찾아 삭제하는 요청입니다.</p>

<h3>PUT /users/:id</h3>

<p>데이테베이스에 있는 id의 사용자의 정보를 변경한는 요청입니다. 변경할 데이터 예를 들면 이름, 비밀보호 값은 요청 바디에 담아 보내게 됩니다.</p>

        </div>

        <div class="media_content media_item shadow_panel">
            <p>Tags : <a href="/tags/javascript">javascript</a>&nbsp;<a href="/tags/framework">framework</a>&nbsp;<a href="/tags/ExpressJS">ExpressJS</a>&nbsp;<a href="/tags/JS">JS</a>&nbsp;<a href="/tags/tutorial">tutorial</a>&nbsp;<a href="/tags/NodeJS">NodeJS</a>&nbsp;<a href="/tags/Sequelize">Sequelize</a>&nbsp;<a href="/tags/Mocha">Mocha</a>&nbsp;<a href="/tags/Supertest">Supertest</a>&nbsp;<a href="/tags/UnitTest">UnitTest</a>&nbsp;</p>
        </div>


        <div class="media_content media_item shadow_panel">
            <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'html5krforkisa'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
        </div>

    </div>

    <script>
        $('#main_content').toc();
    </script>
</div>
<footer>
<table width="100%" height="80" class="footer">
    <tr>
        <td align="center" class="footer_content">
            WebFrameworks.kr @since 2015
        </td>
    </tr>
</table>
</footer>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-56520981-1', 'auto');
    ga('send', 'pageview');

</script>
</body>
</html>