<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<style>
@import url(https://fonts.googleapis.com/earlyaccess/nanumgothic.css); /* 나눔고딕 : 'Nanum Gothic' */
</style>
<title>WebFrameworks.kr - ExpressJS에서 이미지파일을 업로드하고 가공하는 방법</title>
<link rel="stylesheet" href="/static/css/bootstrap.min.css">
<link rel="stylesheet" href="/static/css/main.css">
<link rel="stylesheet" href="/static/css/syntax.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="/static/css/toc.css">
    <script type="text/javascript" src="/static/js/jquery.toc.js"></script>
</head>
<body>
<nav class="navbar navbar-default top_menu" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">웹Frameworks</a>
        </div>

        <div class="collapse navbar-collapse" id="navbar-collapse-1">
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/getstarted">Get Started</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/updates">Update</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/tutorials">Tutorials</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/quickstart">Quick Start</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/archives">Archives</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="https://github.com/KoreaHTML5/webframeworks.kr/blob/master/CONTRIBUTE.md" target="_blank">참여하기</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="http://goo.gl/forms/MB9ZxVvdrD" target="_blank">설문하기</a></li>
            </ul>
        </div>
    </div>
</nav>


<div class="content_bg"  style="background-color: #DD1B16;color: #FFFFFF;" >
<div class="col-md-10 col-md-offset-1 title_header jumbotron"  style="background:url() no-repeat center"  >
<h1 class="title_header_title">ExpressJS에서 이미지파일을 업로드하고 가공하는 방법</h1>
<p class="title_header_summary">서버에 이미지파일을 업로드하고, 이미지 리사이징, 메타정보 제거, 블러링등의 가공을 하는 방법에 대해 알아봅니다.</p>
</div>
</div>

<div>

    <div class="col-sm-3 col-md-2 col-md-offset-2">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">작성자</h3>
            </div>
            <div class="panel-body">
                <div class="media">
                    <a class="pull-left" href="#">
                        <img class="media-object profile_img" src="https://avatars0.githubusercontent.com/u/1788964?v=3&s=460" alt="김정환">
                    </a>
                    <div class="media-body">
                        <h4 class="media-heading">
                            김정환

                        </h4>
                        jeonghwan-kim<br>
                    </div>
                </div>
            </div>
        </div>

        <div id="toc_location"></div>

        <div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">Tags</h3>
    </div>
    <div class="panel-body">
        <a href='/tags/jquery/' style='color: rgba(0,0,0,0.067409)'>jquery</a>
<a href='/tags/javascript/' style='color: rgba(0,0,0,7.752024)'>javascript</a>
<a href='/tags/html/' style='color: rgba(0,0,0,0.067409)'>html</a>
<a href='/tags/grunt/' style='color: rgba(0,0,0,0.067409)'>grunt</a>
<a href='/tags/gulp/' style='color: rgba(0,0,0,0.067409)'>gulp</a>
<a href='/tags/build/' style='color: rgba(0,0,0,0.404453)'>build</a>
<a href='/tags/yeoman/' style='color: rgba(0,0,0,0.067409)'>yeoman</a>
<a href='/tags/foundation/' style='color: rgba(0,0,0,0.067409)'>foundation</a>
<a href='/tags/bower/' style='color: rgba(0,0,0,0.134818)'>bower</a>
<a href='/tags/twitter/' style='color: rgba(0,0,0,0.134818)'>twitter</a>
<a href='/tags/framework/' style='color: rgba(0,0,0,2.561538)'>framework</a>
<a href='/tags/angularjs/' style='color: rgba(0,0,0,1.145951)'>angularjs</a>
<a href='/tags/tutorials/' style='color: rgba(0,0,0,1.482996)'>tutorials</a>
<a href='/tags/backbone/' style='color: rgba(0,0,0,0.269636)'>backbone</a>
<a href='/tags/getstarted/' style='color: rgba(0,0,0,0.202227)'>getstarted</a>
<a href='/tags/underscore/' style='color: rgba(0,0,0,0.067409)'>underscore</a>
<a href='/tags/library/' style='color: rgba(0,0,0,0.471862)'>library</a>
<a href='/tags/Ext/' style='color: rgba(0,0,0,0.606680)'>Ext</a>
<a href='/tags/JS/' style='color: rgba(0,0,0,0.943725)'>JS</a>
<a href='/tags/tutorial/' style='color: rgba(0,0,0,0.876316)'>tutorial</a>
<a href='/tags/modernizr/' style='color: rgba(0,0,0,0.067409)'>modernizr</a>
<a href='/tags/bootstrap/' style='color: rgba(0,0,0,0.202227)'>bootstrap</a>
<a href='/tags/quickstart/' style='color: rgba(0,0,0,0.067409)'>quickstart</a>
<a href='/tags/angular-di/' style='color: rgba(0,0,0,0.067409)'>angular-di</a>
<a href='/tags/animation/' style='color: rgba(0,0,0,0.269636)'>animation</a>
<a href='/tags/router/' style='color: rgba(0,0,0,0.067409)'>router</a>
<a href='/tags/promise/' style='color: rgba(0,0,0,0.337045)'>promise</a>
<a href='/tags/responsive/' style='color: rgba(0,0,0,0.067409)'>responsive</a>
<a href='/tags/form/' style='color: rgba(0,0,0,0.134818)'>form</a>
<a href='/tags/validation/' style='color: rgba(0,0,0,0.134818)'>validation</a>
<a href='/tags/map/' style='color: rgba(0,0,0,0.067409)'>map</a>
<a href='/tags/direcitve/' style='color: rgba(0,0,0,0.067409)'>direcitve</a>
<a href='/tags/file/' style='color: rgba(0,0,0,0.134818)'>file</a>
<a href='/tags/test/' style='color: rgba(0,0,0,0.269636)'>test</a>
<a href='/tags/ui-bootstrap/' style='color: rgba(0,0,0,0.067409)'>ui-bootstrap</a>
<a href='/tags/twitter-bootstrap/' style='color: rgba(0,0,0,0.067409)'>twitter-bootstrap</a>
<a href='/tags/express/' style='color: rgba(0,0,0,0.134818)'>express</a>
<a href='/tags/express.js/' style='color: rgba(0,0,0,0.067409)'>express.js</a>
<a href='/tags/node.js/' style='color: rgba(0,0,0,0.202227)'>node.js</a>
<a href='/tags/backend/' style='color: rgba(0,0,0,0.202227)'>backend</a>
<a href='/tags/d3.js/' style='color: rgba(0,0,0,0.067409)'>d3.js</a>
<a href='/tags/visualization/' style='color: rgba(0,0,0,0.067409)'>visualization</a>
<a href='/tags/reactjs/' style='color: rgba(0,0,0,0.134818)'>reactjs</a>
<a href='/tags/expressjs/' style='color: rgba(0,0,0,0.471862)'>expressjs</a>
<a href='/tags/react/' style='color: rgba(0,0,0,1.482996)'>react</a>
<a href='/tags/session/' style='color: rgba(0,0,0,0.134818)'>session</a>
<a href='/tags/meteor/' style='color: rgba(0,0,0,0.539271)'>meteor</a>
<a href='/tags/SEO/' style='color: rgba(0,0,0,0.067409)'>SEO</a>
<a href='/tags/REST/' style='color: rgba(0,0,0,0.067409)'>REST</a>
<a href='/tags/API/' style='color: rgba(0,0,0,0.067409)'>API</a>
<a href='/tags/es2015/' style='color: rgba(0,0,0,0.134818)'>es2015</a>
<a href='/tags/es6/' style='color: rgba(0,0,0,0.741498)'>es6</a>
<a href='/tags/es7/' style='color: rgba(0,0,0,0.134818)'>es7</a>
<a href='/tags/DDP/' style='color: rgba(0,0,0,0.067409)'>DDP</a>
<a href='/tags/ngMessages/' style='color: rgba(0,0,0,0.134818)'>ngMessages</a>
<a href='/tags/jsx/' style='color: rgba(0,0,0,0.067409)'>jsx</a>
<a href='/tags/publish/' style='color: rgba(0,0,0,0.067409)'>publish</a>
<a href='/tags/subscribe/' style='color: rgba(0,0,0,0.067409)'>subscribe</a>
<a href='/tags/meteor.js/' style='color: rgba(0,0,0,0.067409)'>meteor.js</a>
<a href='/tags/reactive/' style='color: rgba(0,0,0,0.067409)'>reactive</a>
<a href='/tags/package/' style='color: rgba(0,0,0,0.067409)'>package</a>
<a href='/tags/static/' style='color: rgba(0,0,0,0.067409)'>static</a>
<a href='/tags/assets/' style='color: rgba(0,0,0,0.067409)'>assets</a>
<a href='/tags/public/' style='color: rgba(0,0,0,0.067409)'>public</a>
<a href='/tags/flux/' style='color: rgba(0,0,0,0.269636)'>flux</a>
<a href='/tags/redux/' style='color: rgba(0,0,0,0.471862)'>redux</a>
<a href='/tags/server/' style='color: rgba(0,0,0,0.067409)'>server</a>
<a href='/tags/distribution/' style='color: rgba(0,0,0,0.067409)'>distribution</a>
<a href='/tags/webpack/' style='color: rgba(0,0,0,0.202227)'>webpack</a>
<a href='/tags/development/' style='color: rgba(0,0,0,0.067409)'>development</a>
<a href='/tags/optimization/' style='color: rgba(0,0,0,0.067409)'>optimization</a>
<a href='/tags/immutable/' style='color: rgba(0,0,0,0.067409)'>immutable</a>
<a href='/tags/orm/' style='color: rgba(0,0,0,0.269636)'>orm</a>
<a href='/tags/database/' style='color: rgba(0,0,0,0.269636)'>database</a>
<a href='/tags/hapi.js/' style='color: rgba(0,0,0,0.067409)'>hapi.js</a>
<a href='/tags/hapi/' style='color: rgba(0,0,0,0.269636)'>hapi</a>
<a href='/tags/ionic/' style='color: rgba(0,0,0,0.134818)'>ionic</a>
<a href='/tags/hybrid-app/' style='color: rgba(0,0,0,0.067409)'>hybrid-app</a>
<a href='/tags/django/' style='color: rgba(0,0,0,0.067409)'>django</a>
<a href='/tags/fullstack/' style='color: rgba(0,0,0,0.067409)'>fullstack</a>
<a href='/tags/spa/' style='color: rgba(0,0,0,0.067409)'>spa</a>
<a href='/tags/ExpressJS/' style='color: rgba(0,0,0,0.337045)'>ExpressJS</a>
<a href='/tags/NodeJS/' style='color: rgba(0,0,0,0.337045)'>NodeJS</a>
<a href='/tags/Sequelize/' style='color: rgba(0,0,0,0.337045)'>Sequelize</a>
<a href='/tags/Mocha/' style='color: rgba(0,0,0,0.337045)'>Mocha</a>
<a href='/tags/Supertest/' style='color: rgba(0,0,0,0.337045)'>Supertest</a>
<a href='/tags/UnitTest/' style='color: rgba(0,0,0,0.337045)'>UnitTest</a>
<a href='/tags/this/' style='color: rgba(0,0,0,0.134818)'>this</a>
<a href='/tags/dom/' style='color: rgba(0,0,0,0.067409)'>dom</a>
<a href='/tags/es5/' style='color: rgba(0,0,0,0.134818)'>es5</a>
<a href='/tags/virtualdom/' style='color: rgba(0,0,0,0.134818)'>virtualdom</a>
<a href='/tags/modules/' style='color: rgba(0,0,0,0.067409)'>modules</a>
<a href='/tags/asynchronous/' style='color: rgba(0,0,0,0.067409)'>asynchronous</a>
<a href='/tags/semicolon/' style='color: rgba(0,0,0,0.067409)'>semicolon</a>
<a href='/tags/nodejs/' style='color: rgba(0,0,0,0.067409)'>nodejs</a>
<a href='/tags/ECMAScript2015/' style='color: rgba(0,0,0,0.134818)'>ECMAScript2015</a>
<a href='/tags/babel/' style='color: rgba(0,0,0,0.067409)'>babel</a>
<a href='/tags/angular,/' style='color: rgba(0,0,0,0.067409)'>angular,</a>
<a href='/tags/D3/' style='color: rgba(0,0,0,0.067409)'>D3</a>
<a href='/tags/node/' style='color: rgba(0,0,0,0.134818)'>node</a>
<a href='/tags/aws/' style='color: rgba(0,0,0,0.134818)'>aws</a>
<a href='/tags/dynamoDB/' style='color: rgba(0,0,0,0.067409)'>dynamoDB</a>
<a href='/tags/chrome/' style='color: rgba(0,0,0,0.067409)'>chrome</a>
<a href='/tags/native/' style='color: rgba(0,0,0,0.134818)'>native</a>
<a href='/tags/markdown/' style='color: rgba(0,0,0,0.067409)'>markdown</a>
<a href='/tags/vue/' style='color: rgba(0,0,0,1.617814)'>vue</a>
<a href='/tags/middleware/' style='color: rgba(0,0,0,0.067409)'>middleware</a>
<a href='/tags/electron/' style='color: rgba(0,0,0,0.067409)'>electron</a>
<a href='/tags/typescript/' style='color: rgba(0,0,0,0.067409)'>typescript</a>
<a href='/tags/docker/' style='color: rgba(0,0,0,0.067409)'>docker</a>
<a href='/tags/serverless/' style='color: rgba(0,0,0,0.067409)'>serverless</a>

    </div>
</div>
    </div>

    <div class="col-sm-9 col-md-6">
        <div class="media_content media_item shadow_panel" id="main_content">
            <h1>ExpressJS에서 이미지파일을 업로드하고 가공하는 방법</h1>

<p>웹페이지에서 이미지를 업로드하는 건 우리가 쉽게 볼 수 있는 기능 중에 하나입니다. 이번 튜토리얼에서는 웹페이이지에서 이미지파일을 업로드하고 리사이징등 몇가지 추가 기능을 구현하는 방법에 대해서 알아보도록 하겠습니다.
웹에서 파일 업로드하는 방법에는 아래의 두 가지 방식이 있습니다.</p>

<ul>
<li>applecation/x-www-urlencoded</li>
<li>multipart/form-data</li>
</ul>

<p>전자의 경우 인코딩으로 인한 성능 이슈가 발생할수 있으니 후자의 방법으로 전송하는 것이 좋다고 한다.<a href="http://stackoverflow.com/questions/4007969/application-x-www-form-urlencoded-or-multipart-form-data">참고</a></p>

<h2>이미지 업로드</h2>

<p>이미지 파일을 업로드하는 API를 구현해보도록 하겠습니다.</p>

<h3>파일업로드 API</h3>

<p>우선 이미지 업로드를 위한 프로토콜을 만들어 보겠습니다. 
<em>POST</em> 메소드방식의 /images 프로토콜을 이용해 이미지를 만들건데, 파라메터 file로 하여 이미지 파일을 업로드 하도록 하겠습니다. 
프로토콜 라우팅을 아래와 같이 구현할 것입니다.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>

<span class="cm">/* Create new image */</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span></code></pre></div>

<h3>multer 설치</h3>

<p>이미지 등 바이너리 파일 전송을 위해 익스프레스에서는 <a href="https://guthub.com/expressjs/multer">multer</a>라는 모듈을 제공하는데,
multer는 위에서 설명한 웹 파일 전송방식 중 multipart/form-data 방식을 지원해 주는 익스프레스 미들웨어입니다.
설치는 npm을 통해 간편하게 진행할 수 있습니다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">npm install multer --save
</code></pre></div>
<h3>업로드 로직 구현</h3>

<p>가이드 문서에 보면 간단하게 multer를 해당 라우팅에 삽입하여 사용할 수 있는데, 여기서는 몇가지 조건을 추가하도록 하겠습니다. 
1) 파일명 파라매터를 추가해서 업로드 경로를 설정할수 있도록 한다.
2) 구현을 위해서는 파일 데이터 뿐만 아니라 서버에 저장될 파일 이름도 클라이언트로 부터 받아야 한다. filename이라는 파라매터를 추가하자.
3) 업로드 결과 파일명과 확장자를 리턴받는다.</p>

<p>위의 조건을 반영하여, 라우팅 설정을 아래와 같이 하도록 하겠습니다.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/:filename&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">});</span></code></pre></div>

<p>다음으로 multer 모듈을 래핑한 upload() 함수를 구현하겠습니다.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">upload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">storage</span> <span class="o">=</span> <span class="nx">multer</span><span class="p">.</span><span class="nx">diskStorage</span><span class="p">({</span>
    <span class="c1">// 서버에 저장할 폴더</span>
    <span class="nx">destination</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">imagePath</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="c1">// 서버에 저장할 파일 명</span>
    <span class="nx">filename</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">file</span><span class="p">.</span><span class="nx">uploadedFile</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">filename</span><span class="p">,</span>
        <span class="nx">ext</span><span class="o">:</span> <span class="nx">file</span><span class="p">.</span><span class="nx">mimetype</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
      <span class="p">};</span>
      <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">file</span><span class="p">.</span><span class="nx">uploadedFile</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">file</span><span class="p">.</span><span class="nx">uploadedFile</span><span class="p">.</span><span class="nx">ext</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="kd">var</span> <span class="nx">upload</span> <span class="o">=</span> <span class="nx">multer</span><span class="p">({</span> <span class="nx">storage</span><span class="o">:</span> <span class="nx">storage</span> <span class="p">}).</span><span class="nx">single</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">);</span>
  <span class="nx">upload</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">();</span>
    <span class="k">else</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">uploadedFile</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
<span class="p">};</span></code></pre></div>

<p>라우팅 본문에서 위 업로드 함수를 호출하여 성공하면 파일명과 확장자를 포함한 file객체를 응답하고, 실패시 500 에러와 메세지를 보내게됩니다.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/* Create new image */</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/:filename&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">upload</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
  <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<h3>업로드 테스트</h3>

<p>아래의 이미지는 포스트맨으로 테스트한 결과입니다. POST /images/badge1프로토콜을 호출하고 저장 경로는 badge1으로 하였습니다. 
form-data 에 file 필드에 선택한 파일(배지1.png)을 로드하여 호출하였고, 
그 결과 {name: &quot;badge1&quot;, ext: &quot;png&quot;} 객체를 응답받았습니다.</p>

<p><img src="imgs/postman_screenshot.png" style="" alt="이미지 업로드 프로토콜 요청 결과 " title="이미지 업로드 프로토콜 요청 결과 "></p>

<p><img src="imgs/webstorm_screenshot.png" style="" alt="이미지 파일 위치 " title="이미지 파일 위치 "></p>

<h2>이미지 리사이징</h2>

<p>multer 모듈로 이미지 업로드에 성공했다면 서버에 업로드된 이미지 파일 경로을 알수 있습니다. 
이제 gm 모듈을 사용하여 이미지 리사이징 하는 방법에 대해 알아보겠습니다.</p>

<h3>gm 설치</h3>

<p>노드에서 많이 사용하는 이미지 프로세싱 라이브러리 중 하나인 gm을 npm을 통해 설치합니다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ npm install --save gm
</code></pre></div>
<p>gm 라이브러리를 사용하기 위해서는 GraphicsMagick 이나 ImageMagick 등의 라이브러리를 추가 설치해야하는데, 여기서는  GraphicsMagick을 설치하겠습니다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ sudo apt-get install graphicsmagick
</code></pre></div>
<h3>섬네일 이미지 만들기</h3>

<p>라이브러리 사용법은 매우 간단합니다.<br>
<code>require(&#39;gm&#39;)(&#39;파일 경로&#39;)</code> 를 함수 체인으로 이용하여 이미지 처리를 할수 있습니다. 이제 썸네일 이미지를 만들기위해 thumb() 함수를 이용하겠습다.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">gm</span><span class="p">(</span><span class="s1">&#39;image.jpg&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">thumb</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;imgs/thumb.jpg&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="k">else</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;done - thumb&#39;</span><span class="p">);</span>
    <span class="p">});</span></code></pre></div>

<h3>메타 데이터 제거</h3>

<p>이미지 공유시에는, 일부로 이미지 메타정보를 제거하기도 하기 때문에, 이미지 메타정보(EXIF profile data) 제거하기위해 noProfile() 함수를 사용해보겠습니다.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">gm</span><span class="p">(</span><span class="s1">&#39;image.jpg&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">noProfile</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;noprofile.jpg&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="k">else</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;done - noprofile&#39;</span><span class="p">);</span>
    <span class="p">});</span></code></pre></div>

<h3>블러 이미지 만들기</h3>

<p>blur() 함수로 블러 이미지를 생성할 수 있습니다.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">gm</span><span class="p">(</span><span class="s1">&#39;image.jpg&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">blur</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;blur.jpg&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="k">else</span> <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;done - blur&#39;</span><span class="p">)</span>
    <span class="p">});</span></code></pre></div>

<h3>리사이징</h3>

<p>업로드되는 이미지 파일을 하나의 사이즈로 저장하기 위하여, resize(width, height) 함수를 통해 이미지를 리사이징 해보겠습니다. 
파라매터로 넘겨주는 width와 height중 이미지 비율을 유지할 수 있는 값으로 width나 height 값을 취하여 리사이징합니다. 
이것은 thumb()이 이미지를 잘라 내는 것과 다른 점입니다.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">gm</span><span class="p">(</span><span class="s1">&#39;image.jpg&#39;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">resize</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;100_200.jpg&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="k">else</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
  <span class="p">});</span></code></pre></div>

        </div>

        <div class="media_content media_item shadow_panel">
            <p>Tags : <a href="/tags/javascript">javascript</a>&nbsp;<a href="/tags/framework">framework</a>&nbsp;<a href="/tags/expressjs">expressjs</a>&nbsp;<a href="/tags/tutorials">tutorials</a>&nbsp;<a href="/tags/file">file</a>&nbsp;</p>
        </div>


        <div class="media_content media_item shadow_panel">
            <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'html5krforkisa'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
        </div>

    </div>

    <script>
        $('#main_content').toc();
    </script>
</div>
<footer>
<table width="100%" height="80" class="footer">
    <tr>
        <td align="center" class="footer_content">
            WebFrameworks.kr @since 2015
        </td>
    </tr>
</table>
</footer>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-56520981-1', 'auto');
    ga('send', 'pageview');

</script>
</body>
</html>