<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<style>
@import url(https://fonts.googleapis.com/earlyaccess/nanumgothic.css); /* 나눔고딕 : 'Nanum Gothic' */
</style>
<title>WebFrameworks.kr - AWS Severless IoT 17 – Iot Policy + Cognito Identity</title>
<link rel="stylesheet" href="/static/css/bootstrap.min.css">
<link rel="stylesheet" href="/static/css/main.css">
<link rel="stylesheet" href="/static/css/syntax.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="/static/css/toc.css">
    <script type="text/javascript" src="/static/js/jquery.toc.js"></script>
</head>
<body>
<nav class="navbar navbar-default top_menu" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">웹Frameworks</a>
        </div>

        <div class="collapse navbar-collapse" id="navbar-collapse-1">
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/getstarted">Get Started</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/updates">Update</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/tutorials">Tutorials</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/quickstart">Quick Start</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/archives">Archives</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="https://github.com/KoreaHTML5/webframeworks.kr/blob/master/CONTRIBUTE.md" target="_blank">참여하기</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="http://goo.gl/forms/MB9ZxVvdrD" target="_blank">설문하기</a></li>
            </ul>
        </div>
    </div>
</nav>


<div class="content_bg"  style="background-color: #;color: #;" >
<div class="col-md-10 col-md-offset-1 title_header jumbotron"  style="background:url() no-repeat center"  >
<h1 class="title_header_title">AWS Severless IoT 17 – Iot Policy + Cognito Identity</h1>
<p class="title_header_summary">AWS Severless IoT에 대해 알아봅니다.</p>
</div>
</div>

<div>

    <div class="col-sm-3 col-md-2 col-md-offset-2">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">작성자</h3>
            </div>
            <div class="panel-body">
                <div class="media">
                    <a class="pull-left" href="#">
                        <img class="media-object profile_img" src="https://avatars1.githubusercontent.com/u/2949778?s=400&v=4" alt="홍세민">
                    </a>
                    <div class="media-body">
                        <h4 class="media-heading">
                            홍세민

                        </h4>
                        MarcusHong<br>
                    </div>
                </div>
            </div>
        </div>

        <div id="toc_location"></div>

        <div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">Tags</h3>
    </div>
    <div class="panel-body">
        <a href='/tags/jquery/' style='color: rgba(0,0,0,0.058574)'>jquery</a>
<a href='/tags/javascript/' style='color: rgba(0,0,0,9.020374)'>javascript</a>
<a href='/tags/html/' style='color: rgba(0,0,0,0.058574)'>html</a>
<a href='/tags/grunt/' style='color: rgba(0,0,0,0.058574)'>grunt</a>
<a href='/tags/gulp/' style='color: rgba(0,0,0,0.058574)'>gulp</a>
<a href='/tags/build/' style='color: rgba(0,0,0,0.351443)'>build</a>
<a href='/tags/yeoman/' style='color: rgba(0,0,0,0.058574)'>yeoman</a>
<a href='/tags/foundation/' style='color: rgba(0,0,0,0.058574)'>foundation</a>
<a href='/tags/bower/' style='color: rgba(0,0,0,0.117148)'>bower</a>
<a href='/tags/twitter/' style='color: rgba(0,0,0,0.117148)'>twitter</a>
<a href='/tags/framework/' style='color: rgba(0,0,0,2.284380)'>framework</a>
<a href='/tags/angularjs/' style='color: rgba(0,0,0,0.995756)'>angularjs</a>
<a href='/tags/tutorials/' style='color: rgba(0,0,0,1.288625)'>tutorials</a>
<a href='/tags/backbone/' style='color: rgba(0,0,0,0.234295)'>backbone</a>
<a href='/tags/getstarted/' style='color: rgba(0,0,0,0.175722)'>getstarted</a>
<a href='/tags/underscore/' style='color: rgba(0,0,0,0.058574)'>underscore</a>
<a href='/tags/library/' style='color: rgba(0,0,0,0.410017)'>library</a>
<a href='/tags/Ext/' style='color: rgba(0,0,0,0.527165)'>Ext</a>
<a href='/tags/JS/' style='color: rgba(0,0,0,0.820034)'>JS</a>
<a href='/tags/tutorial/' style='color: rgba(0,0,0,0.761460)'>tutorial</a>
<a href='/tags/modernizr/' style='color: rgba(0,0,0,0.058574)'>modernizr</a>
<a href='/tags/bootstrap/' style='color: rgba(0,0,0,0.175722)'>bootstrap</a>
<a href='/tags/quickstart/' style='color: rgba(0,0,0,0.058574)'>quickstart</a>
<a href='/tags/angular-di/' style='color: rgba(0,0,0,0.058574)'>angular-di</a>
<a href='/tags/animation/' style='color: rgba(0,0,0,0.234295)'>animation</a>
<a href='/tags/router/' style='color: rgba(0,0,0,0.058574)'>router</a>
<a href='/tags/promise/' style='color: rgba(0,0,0,0.292869)'>promise</a>
<a href='/tags/responsive/' style='color: rgba(0,0,0,0.058574)'>responsive</a>
<a href='/tags/form/' style='color: rgba(0,0,0,0.117148)'>form</a>
<a href='/tags/validation/' style='color: rgba(0,0,0,0.117148)'>validation</a>
<a href='/tags/map/' style='color: rgba(0,0,0,0.058574)'>map</a>
<a href='/tags/direcitve/' style='color: rgba(0,0,0,0.058574)'>direcitve</a>
<a href='/tags/file/' style='color: rgba(0,0,0,0.117148)'>file</a>
<a href='/tags/test/' style='color: rgba(0,0,0,0.234295)'>test</a>
<a href='/tags/ui-bootstrap/' style='color: rgba(0,0,0,0.058574)'>ui-bootstrap</a>
<a href='/tags/twitter-bootstrap/' style='color: rgba(0,0,0,0.058574)'>twitter-bootstrap</a>
<a href='/tags/express/' style='color: rgba(0,0,0,0.117148)'>express</a>
<a href='/tags/express.js/' style='color: rgba(0,0,0,0.058574)'>express.js</a>
<a href='/tags/node.js/' style='color: rgba(0,0,0,0.234295)'>node.js</a>
<a href='/tags/backend/' style='color: rgba(0,0,0,0.175722)'>backend</a>
<a href='/tags/d3.js/' style='color: rgba(0,0,0,0.058574)'>d3.js</a>
<a href='/tags/visualization/' style='color: rgba(0,0,0,0.058574)'>visualization</a>
<a href='/tags/reactjs/' style='color: rgba(0,0,0,0.117148)'>reactjs</a>
<a href='/tags/expressjs/' style='color: rgba(0,0,0,0.410017)'>expressjs</a>
<a href='/tags/react/' style='color: rgba(0,0,0,1.288625)'>react</a>
<a href='/tags/session/' style='color: rgba(0,0,0,0.117148)'>session</a>
<a href='/tags/meteor/' style='color: rgba(0,0,0,0.820034)'>meteor</a>
<a href='/tags/SEO/' style='color: rgba(0,0,0,0.058574)'>SEO</a>
<a href='/tags/REST/' style='color: rgba(0,0,0,0.058574)'>REST</a>
<a href='/tags/API/' style='color: rgba(0,0,0,0.058574)'>API</a>
<a href='/tags/es2015/' style='color: rgba(0,0,0,0.117148)'>es2015</a>
<a href='/tags/es6/' style='color: rgba(0,0,0,0.644312)'>es6</a>
<a href='/tags/es7/' style='color: rgba(0,0,0,0.117148)'>es7</a>
<a href='/tags/DDP/' style='color: rgba(0,0,0,0.058574)'>DDP</a>
<a href='/tags/ngMessages/' style='color: rgba(0,0,0,0.117148)'>ngMessages</a>
<a href='/tags/jsx/' style='color: rgba(0,0,0,0.058574)'>jsx</a>
<a href='/tags/publish/' style='color: rgba(0,0,0,0.058574)'>publish</a>
<a href='/tags/subscribe/' style='color: rgba(0,0,0,0.058574)'>subscribe</a>
<a href='/tags/meteor.js/' style='color: rgba(0,0,0,0.058574)'>meteor.js</a>
<a href='/tags/reactive/' style='color: rgba(0,0,0,0.058574)'>reactive</a>
<a href='/tags/package/' style='color: rgba(0,0,0,0.058574)'>package</a>
<a href='/tags/static/' style='color: rgba(0,0,0,0.058574)'>static</a>
<a href='/tags/assets/' style='color: rgba(0,0,0,0.058574)'>assets</a>
<a href='/tags/public/' style='color: rgba(0,0,0,0.058574)'>public</a>
<a href='/tags/flux/' style='color: rgba(0,0,0,0.234295)'>flux</a>
<a href='/tags/redux/' style='color: rgba(0,0,0,0.410017)'>redux</a>
<a href='/tags/server/' style='color: rgba(0,0,0,0.058574)'>server</a>
<a href='/tags/distribution/' style='color: rgba(0,0,0,0.058574)'>distribution</a>
<a href='/tags/webpack/' style='color: rgba(0,0,0,0.175722)'>webpack</a>
<a href='/tags/development/' style='color: rgba(0,0,0,0.058574)'>development</a>
<a href='/tags/optimization/' style='color: rgba(0,0,0,0.058574)'>optimization</a>
<a href='/tags/immutable/' style='color: rgba(0,0,0,0.058574)'>immutable</a>
<a href='/tags/orm/' style='color: rgba(0,0,0,0.234295)'>orm</a>
<a href='/tags/database/' style='color: rgba(0,0,0,0.234295)'>database</a>
<a href='/tags/hapi.js/' style='color: rgba(0,0,0,0.058574)'>hapi.js</a>
<a href='/tags/hapi/' style='color: rgba(0,0,0,0.234295)'>hapi</a>
<a href='/tags/ionic/' style='color: rgba(0,0,0,0.117148)'>ionic</a>
<a href='/tags/hybrid-app/' style='color: rgba(0,0,0,0.058574)'>hybrid-app</a>
<a href='/tags/django/' style='color: rgba(0,0,0,0.058574)'>django</a>
<a href='/tags/fullstack/' style='color: rgba(0,0,0,0.058574)'>fullstack</a>
<a href='/tags/spa/' style='color: rgba(0,0,0,0.058574)'>spa</a>
<a href='/tags/ExpressJS/' style='color: rgba(0,0,0,0.292869)'>ExpressJS</a>
<a href='/tags/NodeJS/' style='color: rgba(0,0,0,0.292869)'>NodeJS</a>
<a href='/tags/Sequelize/' style='color: rgba(0,0,0,0.292869)'>Sequelize</a>
<a href='/tags/Mocha/' style='color: rgba(0,0,0,0.292869)'>Mocha</a>
<a href='/tags/Supertest/' style='color: rgba(0,0,0,0.292869)'>Supertest</a>
<a href='/tags/UnitTest/' style='color: rgba(0,0,0,0.292869)'>UnitTest</a>
<a href='/tags/this/' style='color: rgba(0,0,0,0.117148)'>this</a>
<a href='/tags/dom/' style='color: rgba(0,0,0,0.058574)'>dom</a>
<a href='/tags/es5/' style='color: rgba(0,0,0,0.117148)'>es5</a>
<a href='/tags/virtualdom/' style='color: rgba(0,0,0,0.117148)'>virtualdom</a>
<a href='/tags/modules/' style='color: rgba(0,0,0,0.058574)'>modules</a>
<a href='/tags/asynchronous/' style='color: rgba(0,0,0,0.058574)'>asynchronous</a>
<a href='/tags/semicolon/' style='color: rgba(0,0,0,0.058574)'>semicolon</a>
<a href='/tags/nodejs/' style='color: rgba(0,0,0,0.058574)'>nodejs</a>
<a href='/tags/ECMAScript2015/' style='color: rgba(0,0,0,0.117148)'>ECMAScript2015</a>
<a href='/tags/babel/' style='color: rgba(0,0,0,0.058574)'>babel</a>
<a href='/tags/angular,/' style='color: rgba(0,0,0,0.058574)'>angular,</a>
<a href='/tags/electron/' style='color: rgba(0,0,0,0.117148)'>electron</a>
<a href='/tags/docker/' style='color: rgba(0,0,0,0.292869)'>docker</a>
<a href='/tags/D3/' style='color: rgba(0,0,0,0.058574)'>D3</a>
<a href='/tags/node/' style='color: rgba(0,0,0,0.117148)'>node</a>
<a href='/tags/aws/' style='color: rgba(0,0,0,1.405772)'>aws</a>
<a href='/tags/dynamoDB/' style='color: rgba(0,0,0,0.058574)'>dynamoDB</a>
<a href='/tags/chrome/' style='color: rgba(0,0,0,0.058574)'>chrome</a>
<a href='/tags/native/' style='color: rgba(0,0,0,0.117148)'>native</a>
<a href='/tags/markdown/' style='color: rgba(0,0,0,0.058574)'>markdown</a>
<a href='/tags/vue/' style='color: rgba(0,0,0,2.167233)'>vue</a>
<a href='/tags/middleware/' style='color: rgba(0,0,0,0.058574)'>middleware</a>
<a href='/tags/IoT/' style='color: rgba(0,0,0,0.058574)'>IoT</a>
<a href='/tags/serverless/' style='color: rgba(0,0,0,0.058574)'>serverless</a>
<a href='/tags/python/' style='color: rgba(0,0,0,0.175722)'>python</a>
<a href='/tags/socket.io/' style='color: rgba(0,0,0,0.175722)'>socket.io</a>
<a href='/tags/typescript/' style='color: rgba(0,0,0,0.058574)'>typescript</a>
<a href='/tags/laravel/' style='color: rgba(0,0,0,0.058574)'>laravel</a>

    </div>
</div>
    </div>

    <div class="col-sm-9 col-md-6">
        <div class="media_content media_item shadow_panel" id="main_content">
            <h3>IOT + Cognito</h3>

<p>현재까지의 설정만으로 프론트엔드에서 웹소켓 접속을 시도하면 접속이 되지 않는다.
웹소켓 접속을 하기 위해서는 프론트엔드에 IOT에서 설정한 인증서를 설치하거나, 
Cognito Identity Pool로 인증된 유저에 Policy를 연동시키는 방법이 있다.
Cognito에 로그인 없이 비인증된 권한으로도 Cognito와 연결할 수 있지만,
우리는 Cognito를 사용하기 때문에 Identity Pool에 권한을 연동하는 방법을 사용한다.</p>

<h3>Cloudformation</h3>

<ul>
<li>앞서 만들었던 PrivateApisV1에 환경변수를 추가한다.</li>
<li>IOTEndPoint는 aws console -&gt; Iot -&gt; Settings 에 가면 확인할 수 있다.</li>
</ul>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">Resource</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">PrivateApisV1</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">Type</span><span class="p-Indicator">:</span> <span class="s">&#39;AWS::Serverless::Function&#39;</span>
    <span class="l-Scalar-Plain">Properties</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">CodeUri</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">src</span>
      <span class="l-Scalar-Plain">Handler</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">bin/lambda.handler</span>
      <span class="l-Scalar-Plain">Runtime</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">nodejs6.10</span>
      <span class="l-Scalar-Plain">Role</span><span class="p-Indicator">:</span>
        <span class="s">&#39;Fn::GetAtt&#39;</span><span class="p-Indicator">:</span>
          <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">BasicExecutionRole</span>
          <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Arn</span>
      <span class="l-Scalar-Plain">Environment</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">Variables</span><span class="p-Indicator">:</span>
          <span class="l-Scalar-Plain">IOTEndPoint</span><span class="p-Indicator">:</span>
            <span class="s">&#39;endpoint&#39;</span>
          <span class="l-Scalar-Plain">IotAccessPolicy</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">Ref</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">IotAccessPolicy</span>
      <span class="l-Scalar-Plain">Timeout</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">30</span>
      <span class="l-Scalar-Plain">VpcConfig</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">SecurityGroupIds</span><span class="p-Indicator">:</span>
          <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Ref</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">VPCLambdaSecurityGroup</span>
        <span class="l-Scalar-Plain">SubnetIds</span><span class="p-Indicator">:</span>
          <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Ref</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">PublicSubnetA</span>
          <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Ref</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">PublicSubnetB</span>
      <span class="l-Scalar-Plain">Events</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">ProxyApiRoot</span><span class="p-Indicator">:</span>
          <span class="l-Scalar-Plain">Type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Api</span>
          <span class="l-Scalar-Plain">Properties</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">RestApiId</span><span class="p-Indicator">:</span>
              <span class="l-Scalar-Plain">Ref</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ApiGatewayApi</span>
            <span class="l-Scalar-Plain">Path</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/v1</span>
            <span class="l-Scalar-Plain">Method</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ANY</span>
        <span class="l-Scalar-Plain">ProxyApiGreedy</span><span class="p-Indicator">:</span>
          <span class="l-Scalar-Plain">Type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Api</span>
          <span class="l-Scalar-Plain">Properties</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">RestApiId</span><span class="p-Indicator">:</span>
              <span class="l-Scalar-Plain">Ref</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ApiGatewayApi</span>
            <span class="l-Scalar-Plain">Path</span><span class="p-Indicator">:</span> <span class="s">&#39;/v1/{proxy+}&#39;</span>
            <span class="l-Scalar-Plain">Method</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ANY</span>
</code></pre></div>
<h3>express.js</h3>

<ul>
<li>Identity Pool에 생성된 ID는 유니크 값이므로 회원가입이나 최초 유저 정보 입력 시에 한번만 처리하면 된다.</li>
<li>아래는 express.js 에서 Cognito Identity Id에 권한을 연동하는 예제이다.</li>
<li>추가된 Policy에 만약 연동된 계정이 있다면 수동으로 삭제해야 Policy를 삭제할 수 있다.</li>
</ul>

        </div>

        <div class="media_content media_item shadow_panel">
            <p>Tags : <a href="/tags/aws">aws</a>&nbsp;</p>
        </div>


        <div class="media_content media_item shadow_panel">
            <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'html5krforkisa'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
        </div>

    </div>

    <script>
        $('#main_content').toc();
    </script>
</div>
<footer>
<table width="100%" height="80" class="footer">
    <tr>
        <td align="center" class="footer_content">
            WebFrameworks.kr @since 2015
        </td>
    </tr>
</table>
</footer>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-56520981-1', 'auto');
    ga('send', 'pageview');

</script>
</body>
</html>