<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<style>
@import url(https://fonts.googleapis.com/earlyaccess/nanumgothic.css); /* 나눔고딕 : 'Nanum Gothic' */
</style>
<title>WebFrameworks.kr - AWS Severless IoT 2 – Cloudformation으로 Base Stack 만들기</title>
<link rel="stylesheet" href="/static/css/bootstrap.min.css">
<link rel="stylesheet" href="/static/css/main.css">
<link rel="stylesheet" href="/static/css/syntax.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="/static/css/toc.css">
    <script type="text/javascript" src="/static/js/jquery.toc.js"></script>
</head>
<body>
<nav class="navbar navbar-default top_menu" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">웹Frameworks</a>
        </div>

        <div class="collapse navbar-collapse" id="navbar-collapse-1">
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/getstarted">Get Started</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/updates">Update</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/tutorials">Tutorials</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/quickstart">Quick Start</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/archives">Archives</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="https://github.com/KoreaHTML5/webframeworks.kr/blob/master/CONTRIBUTE.md" target="_blank">참여하기</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="http://goo.gl/forms/MB9ZxVvdrD" target="_blank">설문하기</a></li>
            </ul>
        </div>
    </div>
</nav>


<div class="content_bg"  style="background-color: #;color: #;" >
<div class="col-md-10 col-md-offset-1 title_header jumbotron"  style="background:url() no-repeat center"  >
<h1 class="title_header_title">AWS Severless IoT 2 – Cloudformation으로 Base Stack 만들기</h1>
<p class="title_header_summary">AWS Severless IoT에 대해 알아봅니다.</p>
</div>
</div>

<div>

    <div class="col-sm-3 col-md-2 col-md-offset-2">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">작성자</h3>
            </div>
            <div class="panel-body">
                <div class="media">
                    <a class="pull-left" href="#">
                        <img class="media-object profile_img" src="https://avatars1.githubusercontent.com/u/2949778?s=400&v=4" alt="홍세민">
                    </a>
                    <div class="media-body">
                        <h4 class="media-heading">
                            홍세민

                        </h4>
                        MarcusHong<br>
                    </div>
                </div>
            </div>
        </div>

        <div id="toc_location"></div>

        <div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">Tags</h3>
    </div>
    <div class="panel-body">
        <a href='/tags/jquery/' style='color: rgba(0,0,0,0.058163)'>jquery</a>
<a href='/tags/javascript/' style='color: rgba(0,0,0,8.957143)'>javascript</a>
<a href='/tags/html/' style='color: rgba(0,0,0,0.058163)'>html</a>
<a href='/tags/grunt/' style='color: rgba(0,0,0,0.058163)'>grunt</a>
<a href='/tags/gulp/' style='color: rgba(0,0,0,0.058163)'>gulp</a>
<a href='/tags/build/' style='color: rgba(0,0,0,0.348980)'>build</a>
<a href='/tags/yeoman/' style='color: rgba(0,0,0,0.058163)'>yeoman</a>
<a href='/tags/foundation/' style='color: rgba(0,0,0,0.058163)'>foundation</a>
<a href='/tags/bower/' style='color: rgba(0,0,0,0.116327)'>bower</a>
<a href='/tags/twitter/' style='color: rgba(0,0,0,0.116327)'>twitter</a>
<a href='/tags/framework/' style='color: rgba(0,0,0,2.268367)'>framework</a>
<a href='/tags/angularjs/' style='color: rgba(0,0,0,0.988776)'>angularjs</a>
<a href='/tags/tutorials/' style='color: rgba(0,0,0,1.279592)'>tutorials</a>
<a href='/tags/backbone/' style='color: rgba(0,0,0,0.232653)'>backbone</a>
<a href='/tags/getstarted/' style='color: rgba(0,0,0,0.174490)'>getstarted</a>
<a href='/tags/underscore/' style='color: rgba(0,0,0,0.058163)'>underscore</a>
<a href='/tags/library/' style='color: rgba(0,0,0,0.407143)'>library</a>
<a href='/tags/Ext/' style='color: rgba(0,0,0,0.523469)'>Ext</a>
<a href='/tags/JS/' style='color: rgba(0,0,0,0.814286)'>JS</a>
<a href='/tags/tutorial/' style='color: rgba(0,0,0,0.756122)'>tutorial</a>
<a href='/tags/modernizr/' style='color: rgba(0,0,0,0.058163)'>modernizr</a>
<a href='/tags/bootstrap/' style='color: rgba(0,0,0,0.174490)'>bootstrap</a>
<a href='/tags/quickstart/' style='color: rgba(0,0,0,0.058163)'>quickstart</a>
<a href='/tags/angular-di/' style='color: rgba(0,0,0,0.058163)'>angular-di</a>
<a href='/tags/animation/' style='color: rgba(0,0,0,0.232653)'>animation</a>
<a href='/tags/router/' style='color: rgba(0,0,0,0.058163)'>router</a>
<a href='/tags/promise/' style='color: rgba(0,0,0,0.290816)'>promise</a>
<a href='/tags/responsive/' style='color: rgba(0,0,0,0.058163)'>responsive</a>
<a href='/tags/form/' style='color: rgba(0,0,0,0.116327)'>form</a>
<a href='/tags/validation/' style='color: rgba(0,0,0,0.116327)'>validation</a>
<a href='/tags/map/' style='color: rgba(0,0,0,0.058163)'>map</a>
<a href='/tags/direcitve/' style='color: rgba(0,0,0,0.058163)'>direcitve</a>
<a href='/tags/file/' style='color: rgba(0,0,0,0.116327)'>file</a>
<a href='/tags/test/' style='color: rgba(0,0,0,0.232653)'>test</a>
<a href='/tags/ui-bootstrap/' style='color: rgba(0,0,0,0.058163)'>ui-bootstrap</a>
<a href='/tags/twitter-bootstrap/' style='color: rgba(0,0,0,0.058163)'>twitter-bootstrap</a>
<a href='/tags/express/' style='color: rgba(0,0,0,0.116327)'>express</a>
<a href='/tags/express.js/' style='color: rgba(0,0,0,0.058163)'>express.js</a>
<a href='/tags/node.js/' style='color: rgba(0,0,0,0.232653)'>node.js</a>
<a href='/tags/backend/' style='color: rgba(0,0,0,0.174490)'>backend</a>
<a href='/tags/d3.js/' style='color: rgba(0,0,0,0.058163)'>d3.js</a>
<a href='/tags/visualization/' style='color: rgba(0,0,0,0.058163)'>visualization</a>
<a href='/tags/reactjs/' style='color: rgba(0,0,0,0.116327)'>reactjs</a>
<a href='/tags/expressjs/' style='color: rgba(0,0,0,0.407143)'>expressjs</a>
<a href='/tags/react/' style='color: rgba(0,0,0,1.279592)'>react</a>
<a href='/tags/session/' style='color: rgba(0,0,0,0.116327)'>session</a>
<a href='/tags/meteor/' style='color: rgba(0,0,0,0.814286)'>meteor</a>
<a href='/tags/SEO/' style='color: rgba(0,0,0,0.058163)'>SEO</a>
<a href='/tags/REST/' style='color: rgba(0,0,0,0.058163)'>REST</a>
<a href='/tags/API/' style='color: rgba(0,0,0,0.058163)'>API</a>
<a href='/tags/es2015/' style='color: rgba(0,0,0,0.116327)'>es2015</a>
<a href='/tags/es6/' style='color: rgba(0,0,0,0.639796)'>es6</a>
<a href='/tags/es7/' style='color: rgba(0,0,0,0.116327)'>es7</a>
<a href='/tags/DDP/' style='color: rgba(0,0,0,0.058163)'>DDP</a>
<a href='/tags/ngMessages/' style='color: rgba(0,0,0,0.116327)'>ngMessages</a>
<a href='/tags/jsx/' style='color: rgba(0,0,0,0.058163)'>jsx</a>
<a href='/tags/publish/' style='color: rgba(0,0,0,0.058163)'>publish</a>
<a href='/tags/subscribe/' style='color: rgba(0,0,0,0.058163)'>subscribe</a>
<a href='/tags/meteor.js/' style='color: rgba(0,0,0,0.058163)'>meteor.js</a>
<a href='/tags/reactive/' style='color: rgba(0,0,0,0.058163)'>reactive</a>
<a href='/tags/package/' style='color: rgba(0,0,0,0.058163)'>package</a>
<a href='/tags/static/' style='color: rgba(0,0,0,0.058163)'>static</a>
<a href='/tags/assets/' style='color: rgba(0,0,0,0.058163)'>assets</a>
<a href='/tags/public/' style='color: rgba(0,0,0,0.058163)'>public</a>
<a href='/tags/flux/' style='color: rgba(0,0,0,0.232653)'>flux</a>
<a href='/tags/redux/' style='color: rgba(0,0,0,0.407143)'>redux</a>
<a href='/tags/server/' style='color: rgba(0,0,0,0.058163)'>server</a>
<a href='/tags/distribution/' style='color: rgba(0,0,0,0.058163)'>distribution</a>
<a href='/tags/webpack/' style='color: rgba(0,0,0,0.174490)'>webpack</a>
<a href='/tags/development/' style='color: rgba(0,0,0,0.058163)'>development</a>
<a href='/tags/optimization/' style='color: rgba(0,0,0,0.058163)'>optimization</a>
<a href='/tags/immutable/' style='color: rgba(0,0,0,0.058163)'>immutable</a>
<a href='/tags/orm/' style='color: rgba(0,0,0,0.232653)'>orm</a>
<a href='/tags/database/' style='color: rgba(0,0,0,0.232653)'>database</a>
<a href='/tags/hapi.js/' style='color: rgba(0,0,0,0.058163)'>hapi.js</a>
<a href='/tags/hapi/' style='color: rgba(0,0,0,0.232653)'>hapi</a>
<a href='/tags/ionic/' style='color: rgba(0,0,0,0.116327)'>ionic</a>
<a href='/tags/hybrid-app/' style='color: rgba(0,0,0,0.058163)'>hybrid-app</a>
<a href='/tags/django/' style='color: rgba(0,0,0,0.058163)'>django</a>
<a href='/tags/fullstack/' style='color: rgba(0,0,0,0.058163)'>fullstack</a>
<a href='/tags/spa/' style='color: rgba(0,0,0,0.058163)'>spa</a>
<a href='/tags/ExpressJS/' style='color: rgba(0,0,0,0.290816)'>ExpressJS</a>
<a href='/tags/NodeJS/' style='color: rgba(0,0,0,0.290816)'>NodeJS</a>
<a href='/tags/Sequelize/' style='color: rgba(0,0,0,0.290816)'>Sequelize</a>
<a href='/tags/Mocha/' style='color: rgba(0,0,0,0.290816)'>Mocha</a>
<a href='/tags/Supertest/' style='color: rgba(0,0,0,0.290816)'>Supertest</a>
<a href='/tags/UnitTest/' style='color: rgba(0,0,0,0.290816)'>UnitTest</a>
<a href='/tags/this/' style='color: rgba(0,0,0,0.116327)'>this</a>
<a href='/tags/dom/' style='color: rgba(0,0,0,0.058163)'>dom</a>
<a href='/tags/es5/' style='color: rgba(0,0,0,0.116327)'>es5</a>
<a href='/tags/virtualdom/' style='color: rgba(0,0,0,0.116327)'>virtualdom</a>
<a href='/tags/modules/' style='color: rgba(0,0,0,0.058163)'>modules</a>
<a href='/tags/asynchronous/' style='color: rgba(0,0,0,0.058163)'>asynchronous</a>
<a href='/tags/semicolon/' style='color: rgba(0,0,0,0.058163)'>semicolon</a>
<a href='/tags/nodejs/' style='color: rgba(0,0,0,0.058163)'>nodejs</a>
<a href='/tags/ECMAScript2015/' style='color: rgba(0,0,0,0.116327)'>ECMAScript2015</a>
<a href='/tags/babel/' style='color: rgba(0,0,0,0.058163)'>babel</a>
<a href='/tags/angular,/' style='color: rgba(0,0,0,0.058163)'>angular,</a>
<a href='/tags/electron/' style='color: rgba(0,0,0,0.116327)'>electron</a>
<a href='/tags/docker/' style='color: rgba(0,0,0,0.290816)'>docker</a>
<a href='/tags/D3/' style='color: rgba(0,0,0,0.058163)'>D3</a>
<a href='/tags/node/' style='color: rgba(0,0,0,0.116327)'>node</a>
<a href='/tags/aws/' style='color: rgba(0,0,0,1.395918)'>aws</a>
<a href='/tags/dynamoDB/' style='color: rgba(0,0,0,0.058163)'>dynamoDB</a>
<a href='/tags/chrome/' style='color: rgba(0,0,0,0.058163)'>chrome</a>
<a href='/tags/native/' style='color: rgba(0,0,0,0.116327)'>native</a>
<a href='/tags/markdown/' style='color: rgba(0,0,0,0.058163)'>markdown</a>
<a href='/tags/vue/' style='color: rgba(0,0,0,2.152041)'>vue</a>
<a href='/tags/middleware/' style='color: rgba(0,0,0,0.058163)'>middleware</a>
<a href='/tags/IoT/' style='color: rgba(0,0,0,0.058163)'>IoT</a>
<a href='/tags/serverless/' style='color: rgba(0,0,0,0.058163)'>serverless</a>
<a href='/tags/python/' style='color: rgba(0,0,0,0.174490)'>python</a>
<a href='/tags/socket.io/' style='color: rgba(0,0,0,0.174490)'>socket.io</a>
<a href='/tags/typescript/' style='color: rgba(0,0,0,0.058163)'>typescript</a>

    </div>
</div>
    </div>

    <div class="col-sm-9 col-md-6">
        <div class="media_content media_item shadow_panel" id="main_content">
            <h3>Cloudformation</h3>

<p>Cloudformation은 각 서비스의 사양, 설정들을 aws console이 아닌 json이나 yaml문서로 작성해서 배포하므로 문서 버저닝을 한다면 리소스 생성, 수정, 조회를 쉽게 할 수 있어 유지보수를 한결 편리하게 해주는 서비스다.
Cloudformation 자체는 무료이기 때문에 기존에 AWS를 사용한다면 부담없이 도입할 수 있다.</p>

<h3>Base Stack의 목적</h3>

<ul>
<li>Lambda를 업로드할 S3를 생성한다.</li>
<li>github에 있는 Cloudformation 템플릿을 가져와서 스택을 생성하게 하는 Codepipeline을 만든다.</li>
<li>완료가 되면 SNS로 설정한 email로 결과를 알려준다.</li>
<li>여기서는 Codepipeline에서 release branch에 소스가 푸시가 될 경우 Cloudformation으로 보내어 스택의 변경 사항을 반영하게 하는 것이므로, 직접하는 것이 편하다면 삭제해도 된다.</li>
</ul>

<h3>전체 코드</h3>

<p>Cloudformation은 yaml, json 두가지 타입 모두로 만들 수 있다. 조금 더 동적으로 런타임시에 일부 기능을 추가, 삭제, 변경을 하고 싶다면 json으로, 그것이 아니라면 yaml 형식으로 만드는 것이 좀 더 읽기가 쉽다. 여기서는 yaml 파일을 사용하도록 한다.</p>

<h4>base-stack.yaml</h4>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">AWSTemplateFormatVersion</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">2010-09-09</span>
<span class="l-Scalar-Plain">Description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Base Stack</span>
<span class="l-Scalar-Plain">Parameters</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">TagPrefix</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">Type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">String</span>
  <span class="l-Scalar-Plain">TemplateFileName</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">Default</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">packaged-stack.yaml</span>
    <span class="l-Scalar-Plain">Type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">String</span>
  <span class="l-Scalar-Plain">Email</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">Type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">String</span>
  <span class="l-Scalar-Plain">GitHubOAuthToken</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">Description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Create a token with &#39;repo&#39; and &#39;admin:repo_hook&#39; permissions here https://github.com/settings/tokens</span>
    <span class="l-Scalar-Plain">Type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">String</span>
  <span class="l-Scalar-Plain">GitHubUser</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">Description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Enter GitHub userName of the repository owner</span>
    <span class="l-Scalar-Plain">Type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">String</span>
  <span class="l-Scalar-Plain">GitHubRepository</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">Type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">String</span>
  <span class="l-Scalar-Plain">GitHubBranch</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">Type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">String</span>
    <span class="l-Scalar-Plain">Default</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">master</span>

<span class="l-Scalar-Plain">Metadata</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">AWS::CloudFormation::Interface</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">ParameterGroups</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Label</span><span class="p-Indicator">:</span>
          <span class="l-Scalar-Plain">default</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">CodePipeline Settings</span>
        <span class="l-Scalar-Plain">Parameters</span><span class="p-Indicator">:</span>
          <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">TemplateFileName</span>
          <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Email</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Label</span><span class="p-Indicator">:</span>
          <span class="l-Scalar-Plain">default</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Github Settings</span>
        <span class="l-Scalar-Plain">Parameters</span><span class="p-Indicator">:</span>
          <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">GitHubOAuthToken</span>
          <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">GitHubUser</span>
          <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">GitHubRepository</span>
          <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">GitHubBranch</span>

<span class="l-Scalar-Plain">Resources</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">S3Bucket</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">Type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">AWS::S3::Bucket</span>
    <span class="l-Scalar-Plain">Properties</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">VersioningConfiguration</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">Status</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Enabled</span>

  <span class="l-Scalar-Plain">CodePipelineSNSTopic</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">Type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">AWS::SNS::Topic</span>
    <span class="l-Scalar-Plain">Properties</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">Subscription</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Endpoint</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">Ref</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Email</span>
          <span class="l-Scalar-Plain">Protocol</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">email</span>

  <span class="l-Scalar-Plain">Pipeline</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">Type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">AWS::CodePipeline::Pipeline</span>
    <span class="l-Scalar-Plain">Properties</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">ArtifactStore</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">Location</span><span class="p-Indicator">:</span>
          <span class="l-Scalar-Plain">Ref</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">S3Bucket</span>
        <span class="l-Scalar-Plain">Type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">S3</span>
      <span class="l-Scalar-Plain">DisableInboundStageTransitions</span><span class="p-Indicator">:</span> <span class="p-Indicator">[]</span>
      <span class="l-Scalar-Plain">RoleArn</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">Fn::GetAtt</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">PipelineRole</span><span class="p-Indicator">,</span> <span class="nv">Arn</span><span class="p-Indicator">]</span>
      <span class="l-Scalar-Plain">Stages</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">GithubTestSource</span>
          <span class="l-Scalar-Plain">Actions</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">GitHub</span>
              <span class="l-Scalar-Plain">ActionTypeId</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">Category</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Source</span>
                <span class="l-Scalar-Plain">Owner</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ThirdParty</span>
                <span class="l-Scalar-Plain">Provider</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">GitHub</span>
                <span class="l-Scalar-Plain">Version</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1</span>
              <span class="l-Scalar-Plain">Configuration</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">Owner</span><span class="p-Indicator">:</span>
                  <span class="l-Scalar-Plain">Ref</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">GitHubUser</span>
                <span class="l-Scalar-Plain">Repo</span><span class="p-Indicator">:</span>
                  <span class="l-Scalar-Plain">Ref</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">GitHubRepository</span>
                <span class="l-Scalar-Plain">Branch</span><span class="p-Indicator">:</span>
                  <span class="l-Scalar-Plain">Ref</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">GitHubBranch</span>
                <span class="l-Scalar-Plain">OAuthToken</span><span class="p-Indicator">:</span>
                  <span class="l-Scalar-Plain">Ref</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">GitHubOAuthToken</span>
                <span class="l-Scalar-Plain">PollForSourceChanges</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
              <span class="l-Scalar-Plain">OutputArtifacts</span><span class="p-Indicator">:</span>
                <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">TemplateSource</span>
              <span class="l-Scalar-Plain">RunOrder</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1</span>

        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">DevStage</span>
          <span class="l-Scalar-Plain">Actions</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">CreateChangeSet</span>
              <span class="l-Scalar-Plain">ActionTypeId</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">Category</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Deploy</span>
                <span class="l-Scalar-Plain">Owner</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">AWS</span>
                <span class="l-Scalar-Plain">Provider</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">CloudFormation</span>
                <span class="l-Scalar-Plain">Version</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1</span>
              <span class="l-Scalar-Plain">InputArtifacts</span><span class="p-Indicator">:</span>
                <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">TemplateSource</span>
              <span class="l-Scalar-Plain">Configuration</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">ActionMode</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">CHANGE_SET_REPLACE</span>
                <span class="l-Scalar-Plain">Capabilities</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">CAPABILITY_IAM</span>
                <span class="l-Scalar-Plain">RoleArn</span><span class="p-Indicator">:</span>
                  <span class="l-Scalar-Plain">Fn::GetAtt</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">CFNRole.Arn</span>
                <span class="l-Scalar-Plain">StackName</span><span class="p-Indicator">:</span>
                  <span class="l-Scalar-Plain">Fn::Sub</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">${TagPrefix}-Dev</span>
                <span class="l-Scalar-Plain">ChangeSetName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">DevChangeSet</span>
                <span class="l-Scalar-Plain">TemplatePath</span><span class="p-Indicator">:</span>
                  <span class="l-Scalar-Plain">Fn::Sub</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">TemplateSource::dist/${TemplateFileName}</span>
                <span class="l-Scalar-Plain">TemplateConfiguration</span><span class="p-Indicator">:</span>
              <span class="l-Scalar-Plain">RunOrder</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">2</span>

            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ExecuteChangeSet</span>
              <span class="l-Scalar-Plain">ActionTypeId</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">Category</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Deploy</span>
                <span class="l-Scalar-Plain">Owner</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">AWS</span>
                <span class="l-Scalar-Plain">Provider</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">CloudFormation</span>
                <span class="l-Scalar-Plain">Version</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1</span>
              <span class="l-Scalar-Plain">Configuration</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">ActionMode</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">CHANGE_SET_EXECUTE</span>
                <span class="l-Scalar-Plain">ChangeSetName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">DevChangeSet</span>
                <span class="l-Scalar-Plain">RoleArn</span><span class="p-Indicator">:</span>
                  <span class="l-Scalar-Plain">Fn::GetAtt</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">CFNRole</span><span class="p-Indicator">,</span> <span class="nv">Arn</span><span class="p-Indicator">]</span>
                <span class="l-Scalar-Plain">StackName</span><span class="p-Indicator">:</span>
                  <span class="l-Scalar-Plain">Fn::Sub</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">${TagPrefix}-Dev</span>
              <span class="l-Scalar-Plain">RunOrder</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">3</span>
  <span class="l-Scalar-Plain">CFNRole</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">Type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">AWS::IAM::Role</span>
    <span class="l-Scalar-Plain">Properties</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">AssumeRolePolicyDocument</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">Statement</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Action</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="s">&#39;sts:AssumeRole&#39;</span><span class="p-Indicator">]</span>
          <span class="l-Scalar-Plain">Effect</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Allow</span>
          <span class="l-Scalar-Plain">Principal</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">Service</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">cloudformation.amazonaws.com</span><span class="p-Indicator">]</span>
        <span class="l-Scalar-Plain">Version</span><span class="p-Indicator">:</span> <span class="s">&#39;2012-10-17&#39;</span>
      <span class="l-Scalar-Plain">Path</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/</span>
      <span class="l-Scalar-Plain">Policies</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">PolicyName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">CloudFormationRole</span>
          <span class="l-Scalar-Plain">PolicyDocument</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">Version</span><span class="p-Indicator">:</span> <span class="s">&#39;2012-10-17&#39;</span>
            <span class="l-Scalar-Plain">Statement</span><span class="p-Indicator">:</span>
              <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Action</span><span class="p-Indicator">:</span>
                  <span class="p-Indicator">-</span> <span class="s">&quot;iam:*&quot;</span>
                  <span class="p-Indicator">-</span> <span class="s">&quot;lambda:*&quot;</span>
                  <span class="p-Indicator">-</span> <span class="s">&quot;iot:*&quot;</span>
                  <span class="p-Indicator">-</span> <span class="s">&quot;rds:*&quot;</span>
                  <span class="p-Indicator">-</span> <span class="s">&quot;ec2:*&quot;</span>
                  <span class="p-Indicator">-</span> <span class="s">&quot;apigateway:*&quot;</span>
                  <span class="p-Indicator">-</span> <span class="s">&quot;cloudformation:*&quot;</span>
                  <span class="p-Indicator">-</span> <span class="s">&quot;cognito-idp:*&quot;</span>
                  <span class="p-Indicator">-</span> <span class="s">&quot;cognito-identity:*&quot;</span>
                  <span class="p-Indicator">-</span> <span class="s">&quot;dynamodb:*&quot;</span>
                  <span class="p-Indicator">-</span> <span class="s">&quot;s3:*&quot;</span>
                <span class="l-Scalar-Plain">Effect</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Allow</span>
                <span class="l-Scalar-Plain">Resource</span><span class="p-Indicator">:</span> <span class="s">&#39;*&#39;</span>

  <span class="l-Scalar-Plain">PipelineRole</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">Type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">AWS::IAM::Role</span>
    <span class="l-Scalar-Plain">Properties</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">AssumeRolePolicyDocument</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">Statement</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Action</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="s">&#39;sts:AssumeRole&#39;</span><span class="p-Indicator">]</span>
          <span class="l-Scalar-Plain">Effect</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Allow</span>
          <span class="l-Scalar-Plain">Principal</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">Service</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">codepipeline.amazonaws.com</span><span class="p-Indicator">]</span>
        <span class="l-Scalar-Plain">Version</span><span class="p-Indicator">:</span> <span class="s">&#39;2012-10-17&#39;</span>
      <span class="l-Scalar-Plain">Path</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/</span>
      <span class="l-Scalar-Plain">Policies</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">PolicyName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">CodePipelineAccess</span>
          <span class="l-Scalar-Plain">PolicyDocument</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">Version</span><span class="p-Indicator">:</span> <span class="s">&#39;2012-10-17&#39;</span>
            <span class="l-Scalar-Plain">Statement</span><span class="p-Indicator">:</span>
              <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Action</span><span class="p-Indicator">:</span>
                <span class="p-Indicator">-</span> <span class="s">&#39;s3:*&#39;</span>
                <span class="p-Indicator">-</span> <span class="s">&#39;cloudformation:CreateStack&#39;</span>
                <span class="p-Indicator">-</span> <span class="s">&#39;cloudformation:DescribeStacks&#39;</span>
                <span class="p-Indicator">-</span> <span class="s">&#39;cloudformation:DeleteStack&#39;</span>
                <span class="p-Indicator">-</span> <span class="s">&#39;cloudformation:UpdateStack&#39;</span>
                <span class="p-Indicator">-</span> <span class="s">&#39;cloudformation:CreateChangeSet&#39;</span>
                <span class="p-Indicator">-</span> <span class="s">&#39;cloudformation:ExecuteChangeSet&#39;</span>
                <span class="p-Indicator">-</span> <span class="s">&#39;cloudformation:DeleteChangeSet&#39;</span>
                <span class="p-Indicator">-</span> <span class="s">&#39;cloudformation:DescribeChangeSet&#39;</span>
                <span class="p-Indicator">-</span> <span class="s">&#39;cloudformation:SetStackPolicy&#39;</span>
                <span class="p-Indicator">-</span> <span class="s">&#39;iam:PassRole&#39;</span>
                <span class="p-Indicator">-</span> <span class="s">&#39;sns:Publish&#39;</span>
                <span class="l-Scalar-Plain">Effect</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Allow</span>
                <span class="l-Scalar-Plain">Resource</span><span class="p-Indicator">:</span> <span class="s">&#39;*&#39;</span>

<span class="l-Scalar-Plain">Outputs</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">S3Bucket</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">Value</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">Ref</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">S3Bucket</span>
  <span class="l-Scalar-Plain">CodePipelineURL</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">Value</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">Fn::Sub</span><span class="p-Indicator">:</span> <span class="s">&quot;https://${AWS::Region}.console.aws.amazon.com/codepipeline/home?region=${AWS::Region}#/view/${TagPrefix}-DevPipeline&quot;</span>
</code></pre></div>
<h4>base-stack.json</h4>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">&quot;ParameterKey&quot;</span><span class="p">:</span> <span class="s2">&quot;TagPrefix&quot;</span><span class="p">,</span>
    <span class="nt">&quot;ParameterValue&quot;</span><span class="p">:</span> <span class="s2">&quot;Sample&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nt">&quot;ParameterKey&quot;</span><span class="p">:</span> <span class="s2">&quot;TemplateFileName&quot;</span><span class="p">,</span>
    <span class="nt">&quot;ParameterValue&quot;</span><span class="p">:</span> <span class="s2">&quot;packaged-stack.yml&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nt">&quot;ParameterKey&quot;</span><span class="p">:</span> <span class="s2">&quot;Email&quot;</span><span class="p">,</span>
    <span class="nt">&quot;ParameterValue&quot;</span><span class="p">:</span> <span class="s2">&quot;email&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nt">&quot;ParameterKey&quot;</span><span class="p">:</span> <span class="s2">&quot;GitHubUser&quot;</span><span class="p">,</span>
    <span class="nt">&quot;ParameterValue&quot;</span><span class="p">:</span> <span class="s2">&quot;username&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nt">&quot;ParameterKey&quot;</span><span class="p">:</span> <span class="s2">&quot;GitHubRepository&quot;</span><span class="p">,</span>
    <span class="nt">&quot;ParameterValue&quot;</span><span class="p">:</span> <span class="s2">&quot;sample-backend&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nt">&quot;ParameterKey&quot;</span><span class="p">:</span> <span class="s2">&quot;GitHubBranch&quot;</span><span class="p">,</span>
    <span class="nt">&quot;ParameterValue&quot;</span><span class="p">:</span> <span class="s2">&quot;release&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nt">&quot;ParameterKey&quot;</span><span class="p">:</span> <span class="s2">&quot;GitHubOAuthToken&quot;</span><span class="p">,</span>
    <span class="nt">&quot;ParameterValue&quot;</span><span class="p">:</span> <span class="s2">&quot;token&quot;</span>
  <span class="p">}</span>
<span class="p">]</span>
</code></pre></div>
<p>리소스를 선언할 때 특정 이름을 지정할 수도 있지만, 대부분의 경우 비워두는 것이 좋다.
이름을 만들게 되면, aws에 같은 이름으로는 같은 이름으로는 리소스를 생성하지 못하기 때문이다.
이름을 비워두게 되면 Cloudformation에서 변수명 뒤에 랜덤값을 넣어 이름을 생성하므로 하나의 템플릿으로 여러 개의  같은 스택을 만들 수 있다.</p>

<h3>주의점</h3>

<ul>
<li>CFNRole 에는 Cloudformation에서 스택을 생성할 시에 필요한 모든 권한이 있어야 한다. 스택 생성시에 발생하는 오류의 대부분 권한 문제에서 나온다.</li>
<li>PollForSourceChanges을 true으로 하게 되면 푸시가 될 때마다 CodePipeline이 동작한다. 같은 branch를 쓰고 싶거나 수동으로 템플릿을 배포하고 싶다면 false를 선택한다.</li>
</ul>

<h3>만든 Yaml 파일 배포</h3>

<p>Aws에 배포하는 방법은 2가지가 있다.</p>

<ul>
<li>Cloudformation Console

<ul>
<li>https://ap-northeast-2.console.aws.amazon.com/cloudformation/designer/home</li>
<li>base-stack.json이 필요없이 직접 console에서 입력하면 된다.</li>
</ul></li>
<li>aws-cli

<ul>
<li>http://docs.aws.amazon.com/cli/latest/reference/cloudformation/index.html</li>
<li>aws-cli 실행시에 base-params.json에 있는 변수를 불러와야 하기 때문에 반드시 필요하다. 개발스택, 운영스택을 나누고 싶다면 이 방법을 추천한다.</li>
</ul></li>
</ul>

        </div>

        <div class="media_content media_item shadow_panel">
            <p>Tags : <a href="/tags/aws">aws</a>&nbsp;</p>
        </div>


        <div class="media_content media_item shadow_panel">
            <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'html5krforkisa'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
        </div>

    </div>

    <script>
        $('#main_content').toc();
    </script>
</div>
<footer>
<table width="100%" height="80" class="footer">
    <tr>
        <td align="center" class="footer_content">
            WebFrameworks.kr @since 2015
        </td>
    </tr>
</table>
</footer>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-56520981-1', 'auto');
    ga('send', 'pageview');

</script>
</body>
</html>