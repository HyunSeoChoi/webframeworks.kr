<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<style>
@import url(https://fonts.googleapis.com/earlyaccess/nanumgothic.css); /* 나눔고딕 : 'Nanum Gothic' */
</style>
<title>WebFrameworks.kr - SEO 제대로 처리하기</title>
<link rel="stylesheet" href="/static/css/bootstrap.min.css">
<link rel="stylesheet" href="/static/css/main.css">
<link rel="stylesheet" href="/static/css/syntax.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="/static/css/toc.css">
    <script type="text/javascript" src="/static/js/jquery.toc.js"></script>
</head>
<body>
<nav class="navbar navbar-default top_menu" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">웹Frameworks</a>
        </div>

        <div class="collapse navbar-collapse" id="navbar-collapse-1">
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/getstarted">Get Started</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/updates">Update</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/tutorials">Tutorials</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/quickstart">Quick Start</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/archives">Archives</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="https://github.com/KoreaHTML5/webframeworks.kr/blob/master/CONTRIBUTE.md" target="_blank">참여하기</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="http://goo.gl/forms/MB9ZxVvdrD" target="_blank">설문하기</a></li>
            </ul>
        </div>
    </div>
</nav>


<div class="content_bg"  style="background-color: #1C1C1F;color: #E4E4E4;" >
<div class="col-md-10 col-md-offset-1 title_header jumbotron"  style="background:url() no-repeat center"  >
<h1 class="title_header_title">SEO 제대로 처리하기</h1>
<p class="title_header_summary">facebook/google 등 외부 서비스들이 접근하는 페이지 요청을 서버사이드 렌더링 없이 필요한 부분만 WebApp package를 사용하여 효율적으로 구현한다.</p>
</div>
</div>

<div>

    <div class="col-sm-3 col-md-2 col-md-offset-2">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">작성자</h3>
            </div>
            <div class="panel-body">
                <div class="media">
                    <a class="pull-left" href="#">
                        <img class="media-object profile_img" src="https://avatars0.githubusercontent.com/u/623157?v=3&s=460" alt="이재호">
                    </a>
                    <div class="media-body">
                        <h4 class="media-heading">
                            이재호

                        </h4>
                        acidsound<br>
                    </div>
                </div>
            </div>
        </div>

        <div id="toc_location"></div>

        <div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">Tags</h3>
    </div>
    <div class="panel-body">
        <a href='/tags/jquery/' style='color: rgba(0,0,0,0.071175)'>jquery</a>
<a href='/tags/javascript/' style='color: rgba(0,0,0,6.761641)'>javascript</a>
<a href='/tags/html/' style='color: rgba(0,0,0,0.071175)'>html</a>
<a href='/tags/grunt/' style='color: rgba(0,0,0,0.071175)'>grunt</a>
<a href='/tags/gulp/' style='color: rgba(0,0,0,0.071175)'>gulp</a>
<a href='/tags/build/' style='color: rgba(0,0,0,0.427051)'>build</a>
<a href='/tags/yeoman/' style='color: rgba(0,0,0,0.071175)'>yeoman</a>
<a href='/tags/foundation/' style='color: rgba(0,0,0,0.071175)'>foundation</a>
<a href='/tags/bower/' style='color: rgba(0,0,0,0.142350)'>bower</a>
<a href='/tags/twitter/' style='color: rgba(0,0,0,0.142350)'>twitter</a>
<a href='/tags/framework/' style='color: rgba(0,0,0,2.704656)'>framework</a>
<a href='/tags/angularjs/' style='color: rgba(0,0,0,1.209978)'>angularjs</a>
<a href='/tags/tutorials/' style='color: rgba(0,0,0,1.565854)'>tutorials</a>
<a href='/tags/backbone/' style='color: rgba(0,0,0,0.284701)'>backbone</a>
<a href='/tags/getstarted/' style='color: rgba(0,0,0,0.213525)'>getstarted</a>
<a href='/tags/underscore/' style='color: rgba(0,0,0,0.071175)'>underscore</a>
<a href='/tags/library/' style='color: rgba(0,0,0,0.498226)'>library</a>
<a href='/tags/Ext/' style='color: rgba(0,0,0,0.640576)'>Ext</a>
<a href='/tags/JS/' style='color: rgba(0,0,0,0.996452)'>JS</a>
<a href='/tags/tutorial/' style='color: rgba(0,0,0,0.925277)'>tutorial</a>
<a href='/tags/modernizr/' style='color: rgba(0,0,0,0.071175)'>modernizr</a>
<a href='/tags/bootstrap/' style='color: rgba(0,0,0,0.213525)'>bootstrap</a>
<a href='/tags/quickstart/' style='color: rgba(0,0,0,0.071175)'>quickstart</a>
<a href='/tags/angular-di/' style='color: rgba(0,0,0,0.071175)'>angular-di</a>
<a href='/tags/animation/' style='color: rgba(0,0,0,0.284701)'>animation</a>
<a href='/tags/router/' style='color: rgba(0,0,0,0.071175)'>router</a>
<a href='/tags/promise/' style='color: rgba(0,0,0,0.355876)'>promise</a>
<a href='/tags/responsive/' style='color: rgba(0,0,0,0.071175)'>responsive</a>
<a href='/tags/form/' style='color: rgba(0,0,0,0.142350)'>form</a>
<a href='/tags/validation/' style='color: rgba(0,0,0,0.142350)'>validation</a>
<a href='/tags/map/' style='color: rgba(0,0,0,0.071175)'>map</a>
<a href='/tags/direcitve/' style='color: rgba(0,0,0,0.071175)'>direcitve</a>
<a href='/tags/file/' style='color: rgba(0,0,0,0.142350)'>file</a>
<a href='/tags/test/' style='color: rgba(0,0,0,0.284701)'>test</a>
<a href='/tags/ui-bootstrap/' style='color: rgba(0,0,0,0.071175)'>ui-bootstrap</a>
<a href='/tags/twitter-bootstrap/' style='color: rgba(0,0,0,0.071175)'>twitter-bootstrap</a>
<a href='/tags/express/' style='color: rgba(0,0,0,0.142350)'>express</a>
<a href='/tags/express.js/' style='color: rgba(0,0,0,0.071175)'>express.js</a>
<a href='/tags/node.js/' style='color: rgba(0,0,0,0.213525)'>node.js</a>
<a href='/tags/backend/' style='color: rgba(0,0,0,0.213525)'>backend</a>
<a href='/tags/d3.js/' style='color: rgba(0,0,0,0.071175)'>d3.js</a>
<a href='/tags/visualization/' style='color: rgba(0,0,0,0.071175)'>visualization</a>
<a href='/tags/reactjs/' style='color: rgba(0,0,0,0.142350)'>reactjs</a>
<a href='/tags/expressjs/' style='color: rgba(0,0,0,0.498226)'>expressjs</a>
<a href='/tags/react/' style='color: rgba(0,0,0,1.565854)'>react</a>
<a href='/tags/session/' style='color: rgba(0,0,0,0.142350)'>session</a>
<a href='/tags/meteor/' style='color: rgba(0,0,0,0.569401)'>meteor</a>
<a href='/tags/SEO/' style='color: rgba(0,0,0,0.071175)'>SEO</a>
<a href='/tags/REST/' style='color: rgba(0,0,0,0.071175)'>REST</a>
<a href='/tags/API/' style='color: rgba(0,0,0,0.071175)'>API</a>
<a href='/tags/es2015/' style='color: rgba(0,0,0,0.142350)'>es2015</a>
<a href='/tags/es6/' style='color: rgba(0,0,0,0.782927)'>es6</a>
<a href='/tags/es7/' style='color: rgba(0,0,0,0.142350)'>es7</a>
<a href='/tags/DDP/' style='color: rgba(0,0,0,0.071175)'>DDP</a>
<a href='/tags/ngMessages/' style='color: rgba(0,0,0,0.142350)'>ngMessages</a>
<a href='/tags/jsx/' style='color: rgba(0,0,0,0.071175)'>jsx</a>
<a href='/tags/publish/' style='color: rgba(0,0,0,0.071175)'>publish</a>
<a href='/tags/subscribe/' style='color: rgba(0,0,0,0.071175)'>subscribe</a>
<a href='/tags/meteor.js/' style='color: rgba(0,0,0,0.071175)'>meteor.js</a>
<a href='/tags/reactive/' style='color: rgba(0,0,0,0.071175)'>reactive</a>
<a href='/tags/package/' style='color: rgba(0,0,0,0.071175)'>package</a>
<a href='/tags/static/' style='color: rgba(0,0,0,0.071175)'>static</a>
<a href='/tags/assets/' style='color: rgba(0,0,0,0.071175)'>assets</a>
<a href='/tags/public/' style='color: rgba(0,0,0,0.071175)'>public</a>
<a href='/tags/flux/' style='color: rgba(0,0,0,0.284701)'>flux</a>
<a href='/tags/redux/' style='color: rgba(0,0,0,0.498226)'>redux</a>
<a href='/tags/server/' style='color: rgba(0,0,0,0.071175)'>server</a>
<a href='/tags/distribution/' style='color: rgba(0,0,0,0.071175)'>distribution</a>
<a href='/tags/webpack/' style='color: rgba(0,0,0,0.213525)'>webpack</a>
<a href='/tags/development/' style='color: rgba(0,0,0,0.071175)'>development</a>
<a href='/tags/optimization/' style='color: rgba(0,0,0,0.071175)'>optimization</a>
<a href='/tags/immutable/' style='color: rgba(0,0,0,0.071175)'>immutable</a>
<a href='/tags/orm/' style='color: rgba(0,0,0,0.284701)'>orm</a>
<a href='/tags/database/' style='color: rgba(0,0,0,0.284701)'>database</a>
<a href='/tags/hapi.js/' style='color: rgba(0,0,0,0.071175)'>hapi.js</a>
<a href='/tags/hapi/' style='color: rgba(0,0,0,0.284701)'>hapi</a>
<a href='/tags/ionic/' style='color: rgba(0,0,0,0.142350)'>ionic</a>
<a href='/tags/hybrid-app/' style='color: rgba(0,0,0,0.071175)'>hybrid-app</a>
<a href='/tags/django/' style='color: rgba(0,0,0,0.071175)'>django</a>
<a href='/tags/fullstack/' style='color: rgba(0,0,0,0.071175)'>fullstack</a>
<a href='/tags/spa/' style='color: rgba(0,0,0,0.071175)'>spa</a>
<a href='/tags/ExpressJS/' style='color: rgba(0,0,0,0.355876)'>ExpressJS</a>
<a href='/tags/NodeJS/' style='color: rgba(0,0,0,0.355876)'>NodeJS</a>
<a href='/tags/Sequelize/' style='color: rgba(0,0,0,0.355876)'>Sequelize</a>
<a href='/tags/Mocha/' style='color: rgba(0,0,0,0.355876)'>Mocha</a>
<a href='/tags/Supertest/' style='color: rgba(0,0,0,0.355876)'>Supertest</a>
<a href='/tags/UnitTest/' style='color: rgba(0,0,0,0.355876)'>UnitTest</a>
<a href='/tags/this/' style='color: rgba(0,0,0,0.142350)'>this</a>
<a href='/tags/dom/' style='color: rgba(0,0,0,0.071175)'>dom</a>
<a href='/tags/es5/' style='color: rgba(0,0,0,0.142350)'>es5</a>
<a href='/tags/virtualdom/' style='color: rgba(0,0,0,0.142350)'>virtualdom</a>
<a href='/tags/modules/' style='color: rgba(0,0,0,0.071175)'>modules</a>
<a href='/tags/asynchronous/' style='color: rgba(0,0,0,0.071175)'>asynchronous</a>
<a href='/tags/semicolon/' style='color: rgba(0,0,0,0.071175)'>semicolon</a>
<a href='/tags/nodejs/' style='color: rgba(0,0,0,0.071175)'>nodejs</a>
<a href='/tags/ECMAScript2015/' style='color: rgba(0,0,0,0.142350)'>ECMAScript2015</a>
<a href='/tags/babel/' style='color: rgba(0,0,0,0.071175)'>babel</a>
<a href='/tags/angular,/' style='color: rgba(0,0,0,0.071175)'>angular,</a>
<a href='/tags/D3/' style='color: rgba(0,0,0,0.071175)'>D3</a>
<a href='/tags/node/' style='color: rgba(0,0,0,0.142350)'>node</a>
<a href='/tags/aws/' style='color: rgba(0,0,0,0.071175)'>aws</a>
<a href='/tags/dynamoDB/' style='color: rgba(0,0,0,0.071175)'>dynamoDB</a>
<a href='/tags/chrome/' style='color: rgba(0,0,0,0.071175)'>chrome</a>
<a href='/tags/native/' style='color: rgba(0,0,0,0.142350)'>native</a>
<a href='/tags/markdown/' style='color: rgba(0,0,0,0.071175)'>markdown</a>
<a href='/tags/vue/' style='color: rgba(0,0,0,0.427051)'>vue</a>
<a href='/tags/middleware/' style='color: rgba(0,0,0,0.071175)'>middleware</a>

    </div>
</div>
    </div>

    <div class="col-sm-9 col-md-6">
        <div class="media_content media_item shadow_panel" id="main_content">
            <h1>[Core Meteor] SEO 제대로 처리하기</h1>

<p>SPA(Single Page Application)에서 항상 나오는 이슈들 중에 facebook이나 검색엔진에 어떻게 노출할 것인가 문제가 있다.</p>

<p>SEO(Search Engine Optimization:검색 엔진 최적화)는 한번 해놓으면 월급이 들어가지 않는 성실한 마케팅 부서 직원과도 같아 하지 않을 이유가 없어서 대중에게 노출되는 서비스를 만드는 분들이라면 꼭 한번 쯤 고민해볼 주제다.</p>

<p>일반 브라우저를 통해 들어오지 않는 facebook graph API 같은 SNS 용 링크 첨부나 google과 같은 검색엔진들에 귀중한 서버 자원을 낭비하지 않으면서 어떻게 하면 효율적으로 그들에게 우리의 자료를 제공할 것인가?</p>

<p>phantomJS 같은 headless browser로 요청 URL마다 서버에서 렌더링하여 처리하는 것도 방법일 수 있다. 하지만 실제 서비스에서 돌려보면 매번 System Call을 하는 것이 부담스럽고 오류율도 만만치 않다.</p>

<p>그렇다면, 대안은? 직접 만드는 것이다. 적을 알고 나를 알면 두려워질게 없다. Meteor는 기본적으로 node.js 위에서 작동하므로 당연히 서버사이드 요청을 처리하는 것을 기존 서버사이드 렌더링 방식으로 처리할 수 있다.</p>

<p>크게 두 가지로 나눠 대응 전략을 세워보고 실제로 적용해본다.</p>

<h2>google의 검색 봇</h2>

<p>검색을 위해 작동하는 크롤러들은 사용자와는 다르게 브라우저를 거치지 않고 직접 들어와서 일회성으로 페이지를 요청하기 때문에 Meteor를 포함한 대부분의 SPA에서는 클라이언트 javascript가 작동하지 않아 올바른 내용을 가져가지 않을 수 있다.
네이버는 <a href="http://webmastertool.naver.com/index.naver"><code>신디케이션(Syndication)</code></a> 을 사용하는 것이 효율적이지만 예외적인 경우라 이 글의 범주를 넘으므로 언급하지 않는다.</p>

<p><a href="https://developers.google.com/webmasters/ajax-crawling/docs/specification">https://developers.google.com/webmasters/ajax-crawling/docs/specification</a> 를 참조하면 ajax crawling의 경우 URL 뒤에 <code>?_escaped_fragment_=</code>를 포함하고 접근할 때 검색엔진에 노출하고 싶은 내용은 보내주면 되겠다.</p>

<h2>facebook 및 SNS</h2>

<p>facebook을 비롯한 SNS에서 신경 써줘야 할 부분은 내가 서비스하고 있는 URL의 링크가 미리보기 같은 기능이 정상적으로 작동할 수 있도록 맞춰야 한다.</p>

<p>medium의 경우를 보면</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">&quot;og:site_name&quot;</span> <span class="na">content=</span><span class="s">&quot;Medium&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">&quot;og:title&quot;</span> <span class="na">content=</span><span class="s">&quot;Medium&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">&quot;og:url&quot;</span> <span class="na">content=</span><span class="s">&quot;https://medium.com/&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">&quot;og:image&quot;</span> <span class="na">content=</span><span class="s">&quot;https://cdn-static-1.medium.com/_/fp/img/default-preview-image.IsBK38jFAJBlWifMLO4z9g.png&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">&quot;fb:app_id&quot;</span> <span class="na">content=</span><span class="s">&quot;542599432471018&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">&quot;og:description&quot;</span> <span class="na">content=</span><span class="s">&quot;Welcome to Medium, a place to read, write, and interact with the stories that matter most to you. Every day thousands of new voices share…&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;twitter:site&quot;</span> <span class="na">content=</span><span class="s">&quot;@Medium&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;publisher&quot;</span> <span class="na">href=</span><span class="s">&quot;https://plus.google.com/103654360130207659246&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;twitter:card&quot;</span> <span class="na">content=</span><span class="s">&quot;summary&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;twitter:app:name:iphone&quot;</span> <span class="na">content=</span><span class="s">&quot;Medium&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;twitter:app:id:iphone&quot;</span> <span class="na">content=</span><span class="s">&quot;828256236&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;twitter:app:url:iphone&quot;</span> <span class="na">content=</span><span class="s">&quot;medium:/&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">&quot;al:ios:app_name&quot;</span> <span class="na">content=</span><span class="s">&quot;Medium&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">&quot;al:ios:app_store_id&quot;</span> <span class="na">content=</span><span class="s">&quot;828256236&quot;</span><span class="nt">&gt;</span></code></pre></div>

<p>이처럼 facebook의 opengraph를 포함한 다양한 내용을 제공한다.</p>

<p>그럼, 접근한 대상이 무엇인지는 어떻게 알 수 있을까? 정답은 HTTP Request의 user-agent를 살펴보는 것이다.</p>

<p>전략은 나왔다. 그러면 이제 어떻게 구현할 것인지 살펴보자.</p>

<h2>Connect package를 사용하자</h2>

<p>Meteor는 다른 javascript framework(angularJS, Backbone, Dojo, Ember, React..)들과 달리 full-stack javascript platform이다.</p>

<p>node.js 기반이기 때문에 당연히 서버사이드 프로그래밍을 할 수 있고, 기존 HTTP요청에 응답하는 전통적인 구조의 웹 어플리케이션도 만들 수 있다.</p>

<p>그 진입점은 <a href="http://docs.meteor.com/#/full/webapp">WebApp package</a> 에서 출발해보자.</p>

<p>WebApp package는 namespace가 없는 Meteor 기본 패키지이므로 <code>meteor add webapp</code>을 꼭 하지 않아도 기본적으로 사용할 수 있다.</p>

<p>먼저, meteor docs의 사용 예를 한번 보자.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Listen to incoming HTTP requests, can only be used on the server</span>
<span class="nx">WebApp</span><span class="p">.</span><span class="nx">connectHandlers</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&quot;/hello&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s2">&quot;Hello world from: &quot;</span> <span class="o">+</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">release</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>

<p>그렇다. node.js를 처음 접하시는 분들이 많이 사용하는 express.js의 사용패턴과 비슷하다.</p>

<p>WebApp.connectHandlers는 express.js의 근간을 이루고 있는 Connect(https://github.com/senchalabs/connect) 객체를 그대로 반환한다.</p>

<p>특정 상황인 요청을 따로 처리하고 나머지는 Meteor 가 처리하도록 하는 예제를 보자.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">WebApp</span><span class="p">.</span><span class="nx">connectHandlers</span><span class="p">;</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/api/rss.xml&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">rss</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;user-agent&#39;</span><span class="p">]</span><span class="o">===</span><span class="s1">&#39;bot&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">next</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></div>

<p>일반적인 경우엔 그냥 next()를 타고 <code>curl -A &quot;bot&quot; http://localhost:3000/api/rss.xml</code> 과 같이 <code>bot</code>이라는 특정 user-agent를 지정하고 요청할 경우 res객체를 통해 응답하고 Meteor가 처리하지 않게 할 수 있다.</p>

<p><code>/post/:id</code> 와 같이 인자를 받고 싶다면 connect 패키지의 미들웨어인 https://www.npmjs.com/package/connect-route 를 사용하거나 아니면 이를 직접 구현한 https://atmospherejs.com/meteorhacks/picker 같은 패키지를 사용하면 더욱 편리하다.</p>

<h2>phantomJS를 Meteor에서 쓰는 방법</h2>

<p>Meteor는 대체로 빠른 프로토타이핑을 위해 덜 좋지만 학습곡선이 낮은 도구들을 미리 제공한다.</p>

<p>Collection을 빠르게 만들고 바로 테스트하기 위하기 위해 항상 조건 없이 모든 내용을 Find 하는 <code>autopublish</code>라던가 클라이언트 콘솔에서 insert, remove 같은 명령을 바로 적용할 수 있는 <code>insecure</code> 같은 패키지들이 그렇다.</p>

<p>만일, 검색엔진이 문제라면 대부분의 경우 <code>meteor add spiderable</code>하여 <code>spiderable</code> 패키지를 추가하는 것으로 해결할 수 있다.</p>

<p>문제는 head 태그 부분인데 클라이언트에서 해결 할 수 없는 것은 아니지만 가볍고 정교한 처리를 위해 spiderable은 실서버에 적용하지 않고 직접 구현하기 위해 <code>spiderable</code>의 작동구조를 이해할 필요가 있다.</p>

<p><a href="https://github.com/meteor/meteor/blob/release-1.1/packages/spiderable/spiderable_server.js#L55">https://github.com/meteor/meteor/blob/release-1.1/packages/spiderable/spiderable_server.js#L55</a> 소스의 내용을 한번 살펴보자. 생각보다 복잡하지 않다.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">Spiderable</span><span class="p">.</span><span class="nx">userAgentRegExps</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sr">/^facebookexternalhit/i</span><span class="p">,</span> <span class="sr">/^linkedinbot/i</span><span class="p">,</span> <span class="sr">/^twitterbot/i</span><span class="p">];</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="nx">WebApp</span><span class="p">.</span><span class="nx">connectHandlers</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// _escaped_fragment_ comes from Google&#39;s AJAX crawling spec:</span>
  <span class="c1">// https://developers.google.com/webmasters/ajax-crawling/docs/specification</span>
  <span class="k">if</span> <span class="p">(</span><span class="sr">/\?.*_escaped_fragment_=/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">)</span> <span class="o">||</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">any</span><span class="p">(</span><span class="nx">Spiderable</span><span class="p">.</span><span class="nx">userAgentRegExps</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">re</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">re</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;user-agent&#39;</span><span class="p">]);</span> <span class="p">}))</span> <span class="p">{</span></code></pre></div>

<p>위에서 말한 두 가지의 전략을 그대로 따른다.
정규식 함수를 사용하여 req.url이 <em>escaped</em>fragment<em>를 포함하고 있거나 user</em>agent가 facebookexternalhit, linkedinbot, twitterbot 과 같은 문자열로 시작하는지 검사하고 있다.</p>

<p>server/ 폴더 아래에 위와 같은 구현을 추가하면 된다.</p>

<h2>서버사이드에서 템플릿 엔진을 사용한 렌더링</h2>

<p>결론은 간단하다. connect를 사용하여 특정 URL에 접근하는 대상을 선별하여 SNS나 검색엔진의 봇들이 원하는 결과를 response에 보내는 것이 전부다.</p>

<p>실제로 해보면 상황별로 템플릿을 만들어 놓고 필요한 부분만 렌더링하면 편리한데</p>

<p>Blaze Template을 사용하는 경우 <a href="https://github.com/meteorhacks/meteor-ssr">meteorhacks:ssr</a> 을 사용하면 <code>/private</code> 폴더안에 template 파일을 넣어놓고 필요한 컬렉션을 직접 가져와서 사용할 수 있다.</p>

<h2>실 적용 사례</h2>

<p><code>meteor add meteorhacks:meteor-ssr</code> 을 사용하여 두 개의 코드를 만든다.</p>

<p>/private/seoTemplate.html</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;html</span> <span class="na">xmlns:cc=</span><span class="s">&quot;http://creativecommons.org/ns#&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;head</span> <span class="na">prefix=</span><span class="s">&quot;og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# krown-meteor-com: http://ogp.me/ns/fb/krown-meteor-com#&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=utf-8&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;width=device-width, initial-scale=1&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">id=</span><span class="s">&quot;feedLink&quot;</span> <span class="na">rel=</span><span class="s">&quot;alternate&quot;</span> <span class="na">type=</span><span class="s">&quot;application/rss+xml&quot;</span> <span class="na">title=</span><span class="s">&quot;RSS&quot;</span> <span class="na">href=</span><span class="s">&quot;/feed&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;canonical&quot;</span> <span class="na">href=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;title&quot;</span> <span class="na">content=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;referrer&quot;</span> <span class="na">content=</span><span class="s">&quot;always&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span>
          <span class="na">content=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">&quot;og:site_name&quot;</span> <span class="na">content=</span><span class="s">&quot;krown&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">&quot;og:title&quot;</span> <span class="na">content=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">&quot;og:url&quot;</span> <span class="na">content=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">&quot;og:image&quot;</span> <span class="na">content=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">&quot;fb:app_id&quot;</span> <span class="na">content=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">&quot;og:description&quot;</span>
          <span class="na">content=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></div>

<p>/server/seo.js</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">userAgentRegExps</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sr">/^facebookexternalhit/i</span><span class="p">,</span> <span class="sr">/^linkedinbot/i</span><span class="p">,</span> <span class="sr">/^twitterbot/i</span><span class="p">];</span>
<span class="nx">WebApp</span><span class="p">.</span><span class="nx">connectHandlers</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="sr">/\?.*_escaped_fragment_=/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">)</span> <span class="o">||</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">any</span><span class="p">(</span><span class="nx">userAgentRegExps</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">re</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">re</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;user-agent&#39;</span><span class="p">]);</span>
        <span class="p">}))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="sr">/^\/postView\/.+/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">SSR</span><span class="p">.</span><span class="nx">compileTemplate</span><span class="p">(</span><span class="s2">&quot;seo&quot;</span><span class="p">,</span> <span class="nx">Assets</span><span class="p">.</span><span class="nx">getText</span><span class="p">(</span><span class="s1">&#39;postView.html&#39;</span><span class="p">));</span>
            <span class="kd">var</span> <span class="nx">post</span> <span class="o">=</span> <span class="nx">Posts</span><span class="p">.</span><span class="nx">findOne</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\/postView\/(.+)/</span><span class="p">)[</span><span class="mi">1</span><span class="p">]));</span>
            <span class="nx">Template</span><span class="p">.</span><span class="nx">seo</span><span class="p">.</span><span class="nx">helpers</span><span class="p">({</span>
                <span class="nx">author</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">findOne</span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">createdUser</span><span class="p">);</span>
                <span class="p">},</span>
                <span class="nx">summarize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">summarize</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39; ...&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n/g</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">);</span>
                <span class="p">},</span>
                <span class="nx">appId</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">facebook</span><span class="p">.</span><span class="nx">production</span><span class="p">.</span><span class="nx">appId</span>
                <span class="p">}</span>
            <span class="p">});</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s2">&quot;&lt;!DOCTYPE html&gt;&quot;</span> <span class="o">+</span> <span class="nx">SSR</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;seo&quot;</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">post</span><span class="p">,</span> <span class="p">{</span>
                    <span class="nx">url</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">url</span>
                <span class="p">})));</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">next</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></div>

<p>Posts라는 Collection에서 해당 ID를 바라보는 한 건에 대해 렌더링하는 예인데 클라이언트에서 하듯 Template을 작성하고 seo.js 안에서 <code>SSR.compileTemplate</code>을 통해 Template html 파일을 설정하고 helpers에 필요한 값들을 설정하고 난 뒤 SSR.render를 통해 response로 내보낸다.</p>

<p>만일 React를 사랑하고 익숙한 경우라면 <code>meteor add react</code>를 이용해 react npm package를 사용해서 처리해보자.</p>

<p>Meteor에선 클라이언트와 서버 양쪽 모두 추가가 되므로 별다른 설정없이 바로 쓰면 된다. 매우 편리하고 매력적이지 않은가!</p>

        </div>

        <div class="media_content media_item shadow_panel">
            <p>Tags : <a href="/tags/javascript">javascript</a>&nbsp;<a href="/tags/meteor">meteor</a>&nbsp;<a href="/tags/SEO">SEO</a>&nbsp;</p>
        </div>


        <div class="media_content media_item shadow_panel">
            <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'html5krforkisa'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
        </div>

    </div>

    <script>
        $('#main_content').toc();
    </script>
</div>
<footer>
<table width="100%" height="80" class="footer">
    <tr>
        <td align="center" class="footer_content">
            WebFrameworks.kr @since 2015
        </td>
    </tr>
</table>
</footer>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-56520981-1', 'auto');
    ga('send', 'pageview');

</script>
</body>
</html>