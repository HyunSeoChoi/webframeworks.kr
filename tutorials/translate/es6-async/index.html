<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<style>
@import url(https://fonts.googleapis.com/earlyaccess/nanumgothic.css); /* 나눔고딕 : 'Nanum Gothic' */
</style>
<title>WebFrameworks.kr - ES6 비동기 프로그래밍</title>
<link rel="stylesheet" href="/static/css/bootstrap.min.css">
<link rel="stylesheet" href="/static/css/main.css">
<link rel="stylesheet" href="/static/css/syntax.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="/static/css/toc.css">
    <script type="text/javascript" src="/static/js/jquery.toc.js"></script>
</head>
<body>
<nav class="navbar navbar-default top_menu" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">웹Frameworks</a>
        </div>

        <div class="collapse navbar-collapse" id="navbar-collapse-1">
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/getstarted">Get Started</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/updates">Update</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/tutorials">Tutorials</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/quickstart">Quick Start</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/archives">Archives</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="https://github.com/KoreaHTML5/webframeworks.kr/blob/master/CONTRIBUTE.md" target="_blank">참여하기</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="http://goo.gl/forms/MB9ZxVvdrD" target="_blank">설문하기</a></li>
            </ul>
        </div>
    </div>
</nav>


<div class="content_bg"  style="background-color: #F1F71A;color: #;" >
<div class="col-md-10 col-md-offset-1 title_header jumbotron"  style="background:url() no-repeat center"  >
<h1 class="title_header_title">ES6 비동기 프로그래밍</h1>
<p class="title_header_summary">자바스크립트의 비동기 프로그래밍(asynchronous programming) 기본에 대한 이야기입니다.</p>
</div>
</div>

<div>

    <div class="col-sm-3 col-md-2 col-md-offset-2">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">작성자</h3>
            </div>
            <div class="panel-body">
                <div class="media">
                    <a class="pull-left" href="#">
                        <img class="media-object profile_img" src="https://avatars0.githubusercontent.com/u/8802261?v=3&s=400" alt="박관웅">
                    </a>
                    <div class="media-body">
                        <h4 class="media-heading">
                            박관웅

                        </h4>
                        pouu69<br>
                    </div>
                </div>
            </div>
        </div>

        <div id="toc_location"></div>

        <div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">Tags</h3>
    </div>
    <div class="panel-body">
        <a href='/tags/jquery/' style='color: rgba(0,0,0,0.059761)'>jquery</a>
<a href='/tags/javascript/' style='color: rgba(0,0,0,10.996016)'>javascript</a>
<a href='/tags/html/' style='color: rgba(0,0,0,0.059761)'>html</a>
<a href='/tags/grunt/' style='color: rgba(0,0,0,0.059761)'>grunt</a>
<a href='/tags/gulp/' style='color: rgba(0,0,0,0.059761)'>gulp</a>
<a href='/tags/build/' style='color: rgba(0,0,0,0.418327)'>build</a>
<a href='/tags/yeoman/' style='color: rgba(0,0,0,0.059761)'>yeoman</a>
<a href='/tags/foundation/' style='color: rgba(0,0,0,0.059761)'>foundation</a>
<a href='/tags/bower/' style='color: rgba(0,0,0,0.119522)'>bower</a>
<a href='/tags/twitter/' style='color: rgba(0,0,0,0.119522)'>twitter</a>
<a href='/tags/framework/' style='color: rgba(0,0,0,2.450199)'>framework</a>
<a href='/tags/angularjs/' style='color: rgba(0,0,0,1.015936)'>angularjs</a>
<a href='/tags/tutorials/' style='color: rgba(0,0,0,1.314741)'>tutorials</a>
<a href='/tags/backbone/' style='color: rgba(0,0,0,0.239044)'>backbone</a>
<a href='/tags/getstarted/' style='color: rgba(0,0,0,0.179283)'>getstarted</a>
<a href='/tags/underscore/' style='color: rgba(0,0,0,0.059761)'>underscore</a>
<a href='/tags/library/' style='color: rgba(0,0,0,0.418327)'>library</a>
<a href='/tags/Ext/' style='color: rgba(0,0,0,0.537849)'>Ext</a>
<a href='/tags/JS/' style='color: rgba(0,0,0,0.836653)'>JS</a>
<a href='/tags/tutorial/' style='color: rgba(0,0,0,0.776892)'>tutorial</a>
<a href='/tags/modernizr/' style='color: rgba(0,0,0,0.059761)'>modernizr</a>
<a href='/tags/bootstrap/' style='color: rgba(0,0,0,0.179283)'>bootstrap</a>
<a href='/tags/quickstart/' style='color: rgba(0,0,0,0.059761)'>quickstart</a>
<a href='/tags/angular-di/' style='color: rgba(0,0,0,0.059761)'>angular-di</a>
<a href='/tags/animation/' style='color: rgba(0,0,0,0.239044)'>animation</a>
<a href='/tags/router/' style='color: rgba(0,0,0,0.059761)'>router</a>
<a href='/tags/promise/' style='color: rgba(0,0,0,0.298805)'>promise</a>
<a href='/tags/responsive/' style='color: rgba(0,0,0,0.059761)'>responsive</a>
<a href='/tags/form/' style='color: rgba(0,0,0,0.119522)'>form</a>
<a href='/tags/validation/' style='color: rgba(0,0,0,0.119522)'>validation</a>
<a href='/tags/map/' style='color: rgba(0,0,0,0.059761)'>map</a>
<a href='/tags/direcitve/' style='color: rgba(0,0,0,0.059761)'>direcitve</a>
<a href='/tags/file/' style='color: rgba(0,0,0,0.119522)'>file</a>
<a href='/tags/test/' style='color: rgba(0,0,0,0.239044)'>test</a>
<a href='/tags/ui-bootstrap/' style='color: rgba(0,0,0,0.059761)'>ui-bootstrap</a>
<a href='/tags/twitter-bootstrap/' style='color: rgba(0,0,0,0.059761)'>twitter-bootstrap</a>
<a href='/tags/d3.js/' style='color: rgba(0,0,0,0.059761)'>d3.js</a>
<a href='/tags/visualization/' style='color: rgba(0,0,0,0.358566)'>visualization</a>
<a href='/tags/expressjs/' style='color: rgba(0,0,0,0.418327)'>expressjs</a>
<a href='/tags/react/' style='color: rgba(0,0,0,1.792829)'>react</a>
<a href='/tags/session/' style='color: rgba(0,0,0,0.179283)'>session</a>
<a href='/tags/meteor/' style='color: rgba(0,0,0,0.836653)'>meteor</a>
<a href='/tags/SEO/' style='color: rgba(0,0,0,0.059761)'>SEO</a>
<a href='/tags/REST/' style='color: rgba(0,0,0,0.059761)'>REST</a>
<a href='/tags/API/' style='color: rgba(0,0,0,0.059761)'>API</a>
<a href='/tags/es2015/' style='color: rgba(0,0,0,0.119522)'>es2015</a>
<a href='/tags/es6/' style='color: rgba(0,0,0,0.657371)'>es6</a>
<a href='/tags/es7/' style='color: rgba(0,0,0,0.119522)'>es7</a>
<a href='/tags/DDP/' style='color: rgba(0,0,0,0.059761)'>DDP</a>
<a href='/tags/ngMessages/' style='color: rgba(0,0,0,0.119522)'>ngMessages</a>
<a href='/tags/jsx/' style='color: rgba(0,0,0,0.059761)'>jsx</a>
<a href='/tags/publish/' style='color: rgba(0,0,0,0.059761)'>publish</a>
<a href='/tags/subscribe/' style='color: rgba(0,0,0,0.059761)'>subscribe</a>
<a href='/tags/meteor.js/' style='color: rgba(0,0,0,0.059761)'>meteor.js</a>
<a href='/tags/node.js/' style='color: rgba(0,0,0,0.239044)'>node.js</a>
<a href='/tags/backend/' style='color: rgba(0,0,0,0.179283)'>backend</a>
<a href='/tags/reactive/' style='color: rgba(0,0,0,0.059761)'>reactive</a>
<a href='/tags/package/' style='color: rgba(0,0,0,0.059761)'>package</a>
<a href='/tags/static/' style='color: rgba(0,0,0,0.059761)'>static</a>
<a href='/tags/assets/' style='color: rgba(0,0,0,0.059761)'>assets</a>
<a href='/tags/public/' style='color: rgba(0,0,0,0.059761)'>public</a>
<a href='/tags/flux/' style='color: rgba(0,0,0,0.239044)'>flux</a>
<a href='/tags/redux/' style='color: rgba(0,0,0,0.418327)'>redux</a>
<a href='/tags/server/' style='color: rgba(0,0,0,0.059761)'>server</a>
<a href='/tags/distribution/' style='color: rgba(0,0,0,0.059761)'>distribution</a>
<a href='/tags/webpack/' style='color: rgba(0,0,0,0.239044)'>webpack</a>
<a href='/tags/development/' style='color: rgba(0,0,0,0.059761)'>development</a>
<a href='/tags/optimization/' style='color: rgba(0,0,0,0.059761)'>optimization</a>
<a href='/tags/immutable/' style='color: rgba(0,0,0,0.059761)'>immutable</a>
<a href='/tags/orm/' style='color: rgba(0,0,0,0.239044)'>orm</a>
<a href='/tags/database/' style='color: rgba(0,0,0,0.239044)'>database</a>
<a href='/tags/hapi.js/' style='color: rgba(0,0,0,0.059761)'>hapi.js</a>
<a href='/tags/hapi/' style='color: rgba(0,0,0,0.239044)'>hapi</a>
<a href='/tags/ionic/' style='color: rgba(0,0,0,0.119522)'>ionic</a>
<a href='/tags/hybrid-app/' style='color: rgba(0,0,0,0.059761)'>hybrid-app</a>
<a href='/tags/django/' style='color: rgba(0,0,0,0.059761)'>django</a>
<a href='/tags/fullstack/' style='color: rgba(0,0,0,0.059761)'>fullstack</a>
<a href='/tags/spa/' style='color: rgba(0,0,0,0.059761)'>spa</a>
<a href='/tags/ExpressJS/' style='color: rgba(0,0,0,0.298805)'>ExpressJS</a>
<a href='/tags/NodeJS/' style='color: rgba(0,0,0,0.298805)'>NodeJS</a>
<a href='/tags/Sequelize/' style='color: rgba(0,0,0,0.298805)'>Sequelize</a>
<a href='/tags/Mocha/' style='color: rgba(0,0,0,0.298805)'>Mocha</a>
<a href='/tags/Supertest/' style='color: rgba(0,0,0,0.298805)'>Supertest</a>
<a href='/tags/UnitTest/' style='color: rgba(0,0,0,0.298805)'>UnitTest</a>
<a href='/tags/reactjs/' style='color: rgba(0,0,0,0.179283)'>reactjs</a>
<a href='/tags/this/' style='color: rgba(0,0,0,0.119522)'>this</a>
<a href='/tags/dom/' style='color: rgba(0,0,0,0.059761)'>dom</a>
<a href='/tags/es5/' style='color: rgba(0,0,0,0.119522)'>es5</a>
<a href='/tags/virtualdom/' style='color: rgba(0,0,0,0.119522)'>virtualdom</a>
<a href='/tags/modules/' style='color: rgba(0,0,0,0.059761)'>modules</a>
<a href='/tags/asynchronous/' style='color: rgba(0,0,0,0.059761)'>asynchronous</a>
<a href='/tags/semicolon/' style='color: rgba(0,0,0,0.059761)'>semicolon</a>
<a href='/tags/nodejs/' style='color: rgba(0,0,0,0.119522)'>nodejs</a>
<a href='/tags/ECMAScript2015/' style='color: rgba(0,0,0,0.119522)'>ECMAScript2015</a>
<a href='/tags/babel/' style='color: rgba(0,0,0,0.059761)'>babel</a>
<a href='/tags/angular,/' style='color: rgba(0,0,0,0.059761)'>angular,</a>
<a href='/tags/electron/' style='color: rgba(0,0,0,0.119522)'>electron</a>
<a href='/tags/docker/' style='color: rgba(0,0,0,0.478088)'>docker</a>
<a href='/tags/D3/' style='color: rgba(0,0,0,0.059761)'>D3</a>
<a href='/tags/node/' style='color: rgba(0,0,0,0.119522)'>node</a>
<a href='/tags/express/' style='color: rgba(0,0,0,0.119522)'>express</a>
<a href='/tags/aws/' style='color: rgba(0,0,0,1.613546)'>aws</a>
<a href='/tags/dynamoDB/' style='color: rgba(0,0,0,0.059761)'>dynamoDB</a>
<a href='/tags/chrome/' style='color: rgba(0,0,0,0.059761)'>chrome</a>
<a href='/tags/native/' style='color: rgba(0,0,0,0.119522)'>native</a>
<a href='/tags/markdown/' style='color: rgba(0,0,0,0.059761)'>markdown</a>
<a href='/tags/vue/' style='color: rgba(0,0,0,2.211155)'>vue</a>
<a href='/tags/middleware/' style='color: rgba(0,0,0,0.119522)'>middleware</a>
<a href='/tags/IoT/' style='color: rgba(0,0,0,0.059761)'>IoT</a>
<a href='/tags/serverless/' style='color: rgba(0,0,0,0.537849)'>serverless</a>
<a href='/tags/python/' style='color: rgba(0,0,0,0.179283)'>python</a>
<a href='/tags/socket.io/' style='color: rgba(0,0,0,0.179283)'>socket.io</a>
<a href='/tags/typescript/' style='color: rgba(0,0,0,0.059761)'>typescript</a>
<a href='/tags/laravel/' style='color: rgba(0,0,0,1.553785)'>laravel</a>
<a href='/tags/express.js/' style='color: rgba(0,0,0,0.059761)'>express.js</a>
<a href='/tags/next/' style='color: rgba(0,0,0,0.059761)'>next</a>
<a href='/tags/nuxt/' style='color: rgba(0,0,0,0.059761)'>nuxt</a>
<a href='/tags/java/' style='color: rgba(0,0,0,0.059761)'>java</a>
<a href='/tags/spring/' style='color: rgba(0,0,0,0.059761)'>spring</a>
<a href='/tags/github/' style='color: rgba(0,0,0,0.119522)'>github</a>
<a href='/tags/slack/' style='color: rgba(0,0,0,0.119522)'>slack</a>
<a href='/tags/react-native/' style='color: rgba(0,0,0,0.059761)'>react-native</a>
<a href='/tags/data/' style='color: rgba(0,0,0,0.298805)'>data</a>
<a href='/tags/opensource/' style='color: rgba(0,0,0,0.059761)'>opensource</a>
<a href='/tags/pwa/' style='color: rgba(0,0,0,0.059761)'>pwa</a>
<a href='/tags/php/' style='color: rgba(0,0,0,0.059761)'>php</a>
<a href='/tags/vuejs/' style='color: rgba(0,0,0,0.597610)'>vuejs</a>
<a href='/tags/nextjs/' style='color: rgba(0,0,0,0.478088)'>nextjs</a>
<a href='/tags/react_admin/' style='color: rgba(0,0,0,0.179283)'>react_admin</a>
<a href='/tags/webrtc/' style='color: rgba(0,0,0,0.239044)'>webrtc</a>
<a href='/tags/cd/' style='color: rgba(0,0,0,0.059761)'>cd</a>
<a href='/tags/pm2/' style='color: rgba(0,0,0,0.059761)'>pm2</a>
<a href='/tags/docker_registry/' style='color: rgba(0,0,0,0.059761)'>docker_registry</a>
<a href='/tags/ecr/' style='color: rgba(0,0,0,0.059761)'>ecr</a>
<a href='/tags/twilio/' style='color: rgba(0,0,0,0.059761)'>twilio</a>
<a href='/tags/json_schema/' style='color: rgba(0,0,0,0.059761)'>json_schema</a>
<a href='/tags/sql/' style='color: rgba(0,0,0,0.059761)'>sql</a>
<a href='/tags/json/' style='color: rgba(0,0,0,0.059761)'>json</a>
<a href='/tags/web/' style='color: rgba(0,0,0,0.059761)'>web</a>
<a href='/tags/sdk/' style='color: rgba(0,0,0,0.059761)'>sdk</a>
<a href='/tags/ssl/' style='color: rgba(0,0,0,0.059761)'>ssl</a>
<a href='/tags/portainer/' style='color: rgba(0,0,0,0.059761)'>portainer</a>
<a href='/tags/jwt/' style='color: rgba(0,0,0,0.059761)'>jwt</a>
<a href='/tags/mailu/' style='color: rgba(0,0,0,0.059761)'>mailu</a>
<a href='/tags/sam/' style='color: rgba(0,0,0,0.059761)'>sam</a>
<a href='/tags/lambda/' style='color: rgba(0,0,0,0.059761)'>lambda</a>
<a href='/tags/thumbnail/' style='color: rgba(0,0,0,0.059761)'>thumbnail</a>
<a href='/tags/redis/' style='color: rgba(0,0,0,0.059761)'>redis</a>
<a href='/tags/hyperledger/' style='color: rgba(0,0,0,0.418327)'>hyperledger</a>
<a href='/tags/fabric/' style='color: rgba(0,0,0,0.418327)'>fabric</a>

    </div>
</div>
    </div>

    <div class="col-sm-9 col-md-6">
        <div class="media_content media_item shadow_panel" id="main_content">
            <blockquote>
<p>이 문서는 <a href="http://exploringjs.com/es6/ch_async.html">http://exploringjs.com/es6/ch_async.html</a> 를 번역한 내용입니다.</p>
</blockquote>

<h1>Asynchronouse programming (Background)</h1>

<p>이 챕터는 자바스크립트의 비동기 프로그래밍(asynchronous programming) 기본에 대한 이야기입니다. 또한 이번 챕터는 <strong>ES6 Promise</strong>을 위한 기본 배경 지식이기도 합니다.</p>

<h2>1. 자바스크립트 호출 스택(<strong>call stack</strong>)</h2>

<p><code>function f</code> 가 <code>function g</code>를 호출할 때 <code>function g</code>는 끝난 후에 어디로 돌아가야 하는지 알아야합니다.(<code>function f</code> 안에서)<br>
일반적으로 이런 정보는 호출스택(call stack)인 <strong>스택(<em>stack</em>)</strong>이 관리를 합니다.<br>
아래 예제를 봅시다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">h</span><span class="p">(</span><span class="nx">z</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Print stack trace</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">().</span><span class="nx">stack</span><span class="p">);</span> <span class="c1">// (A)</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">g</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">h</span><span class="p">(</span><span class="nx">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// (B)</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">g</span><span class="p">(</span><span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// (C)</span>
<span class="p">}</span>
<span class="nx">f</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span> <span class="c1">// (D)</span>
<span class="k">return</span><span class="p">;</span> <span class="c1">// (E)</span>
</code></pre></div>
<p>처음에는 위 프로그램이 시작될 때, <strong>호출 스택</strong>(the call stack)은 비어있습니다. (D) 라인에 있는 함수 <code>f(3)</code>이 호출되면 스택은 한가지 항목을 가지게 됩니다.</p>

<ul>
<li>전역 스코프 (Location in global scope)</li>
</ul>

<p>(C) 라인에 있는 함수 <code>g(x+1)</code>이 호출 된 후에는 1개가 추가됩니다.</p>

<ul>
<li>함수 <code>f</code> (Location in <code>f</code>)</li>
<li>전역 스코프 (Location in global scope)</li>
</ul>

<p>(B) 라인에 있는 함수 <code>h(y+1)</code> 이 호출된 후에도 1개가 추가됩니다.</p>

<ul>
<li>함수 <code>g</code> (Location in g)</li>
<li>함수 <code>f</code> (Location in <code>f</code>)</li>
<li>전역 스코프 (Location in global scope)</li>
</ul>

<p>마지막 (A)라인이 실행되면 <strong>stack trace</strong> 는 아래와 같이 어떤 stack이 쌓여서 호출돼있는지 확인할 수 있습니다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">Error</span>
    <span class="nx">at</span> <span class="nx">h</span> <span class="p">(</span><span class="nx">stack_trace</span><span class="p">.</span><span class="nx">js</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="mi">17</span><span class="p">)</span>
    <span class="nx">at</span> <span class="nx">g</span> <span class="p">(</span><span class="nx">stack_trace</span><span class="p">.</span><span class="nx">js</span><span class="o">:</span><span class="mi">6</span><span class="o">:</span><span class="mi">5</span><span class="p">)</span>
    <span class="nx">at</span> <span class="nx">f</span> <span class="p">(</span><span class="nx">stack_trace</span><span class="p">.</span><span class="nx">js</span><span class="o">:</span><span class="mi">9</span><span class="o">:</span><span class="mi">5</span><span class="p">)</span>
    <span class="nx">at</span> <span class="o">&lt;</span><span class="nx">global</span><span class="o">&gt;</span> <span class="p">(</span><span class="nx">stack_trace</span><span class="p">.</span><span class="nx">js</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<p>다음으로, 각 함수는 종료되고, 스택의 최상위 요소가 제거 될때마다 함수가 종료됩니다. 마지막 함수 <code>f</code>가 끝나면, <code>전역 스코프(global scope)</code>로 복귀하여 <strong>호출 스택</strong>은 비어 있습니다. 결국 (E)라인이 오면 반환되어 <strong>스택</strong>은 비워지고 프로그램은 종료됨을 의미합니다.</p>

<h2>2. 브라우저 이벤트 루프(event loop)</h2>

<p>간단히 말해서, 각 브라우저 탭은 <strong>싱글 프로세스</strong>(single process : <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop">the event loop</a>)에서 실행됩니다.<br>
이 loop(<em>event loop</em>)는 task queue(고유명사로써 영어를 사용한다.)를 통해 공급되는 브라우저 관련 작업(<em>task</em>)을 실행합니다.<br>
<strong>task</strong>의 예는 다음과 같습니다.</p>

<ul>
<li>task의 예

<ol>
<li>HTML 파싱</li>
<li>자바스크립트 코드 실행</li>
<li>사용자 input 감지 후 반응(마우스 클릭, key 입력 등등)</li>
<li>비동기 네트워크 요청 수행 결과</li>
</ol></li>
</ul>

<p>위 2-4 항목은 브라우저에 내장된 엔진을 통해 자바스크립트 코드를 실행하는 작업입니다. 그것들은 코드가 종료될 때 종료됩니다. 그런 다음 큐에서 다음 <em>task</em>를 가져와 실행합니다. 다음 그림은 이러한 모든 메커니즘이 어떻게 연결되는지 방법을 제공합니다.</p>

<p><img src="http://exploringjs.com/es6/images/async----event_loop.jpg" alt="task 메커니즘"></p>

<p><strong>event loop</strong>는 병렬로 함께 실행되는 다른 프로세스(timers, input handling, etc)로 둘러싸여 있습니다. 이 프로세스는 각각의 <em>task</em>를 <strong>task queue</strong>에 추가하여 프로세스와 통신합니다.</p>

<h3>2-1 타이머(Timers)</h3>

<blockquote>
<p>브라우저는 <a href="https://html.spec.whatwg.org/multipage/webappapis.html#timers">timers</a>를 가지고 있으며 타이머는 <code>setTimeout()</code>을 제공합니다. 그리고 <code>setTimeout()</code>이 발생 될 때까지 기다렸다가, 큐에 <strong>task</strong>를 추가합니다.</p>
</blockquote>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">ms</span><span class="p">);</span>
</code></pre></div>
<p><code>setTimeout()</code>은 <strong>ms</strong>(milliseconds) 경과 후 <code>callback</code>이 <strong>task queue</strong> 에 추가됩니다. 타이머에 <code>callback</code>은 <strong>ms</strong>(milliseconds) 이후 실제 실행되는 게 아니라 <strong>task queue</strong>에 추가되는것이 중요하다는 걸 기억해야 합니다. 왜냐하면
만약 <strong>event loop</strong>가 차단 당하면 지정된 시간 이후보다 나중에 setTimeout() <code>callback</code>이 실행된다는 걸 확인할 수 있기 때문입니다.  </p>

<p>보통 <code>setTimeout()</code> <strong>ms</strong>를 ‘0’ 으로 세팅하는건 <strong>task queue</strong> 에 바로 추가하기 위한 일반적인 방법입니다. 그러나 몇몇 브라우저는 실제로 ‘0’ ms 이후 추가되지 않고 브라우저마다 ‘0’이 아닌 최소 ms가 세팅 되어져 있습니다.(ex : firefox는 4ms임)</p>

<h3>2-2 DOM 변경 표시 (Displaying DOM changes)</h3>

<p>대부분 DOM 변경(특히 layout 재갱신이 포함된 경우)의 경우 화면은 바로 업데이트되지 않습니다. <code>“레이아웃 새로고침은 16ms 정도 시간이 흐른다.”</code><a href="https://twitter.com/bz_moz/status/513777809287028736">@bz_moz</a> 그리고 <strong>event loop</strong>를 통해 실행 할 기회가 주어집니다.  </p>

<p><code>requestAnaimationFrame()</code>을 <a href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame">문서</a>에서 확인해 보면 브라우저가 DOM을 업데이트 빈번하게 업데이트할 경우 레이아웃 흐름에 방해되지 않게 조정할 수가 있다고 합니다.</p>

<h3>2-3 Run-to-completion 의미(고유 용어로써 영어사용)</h3>

<p>자바스크립트는 소위 “run-to-completion” 라는 걸 가지고 있습니다. 항상 현재 <strong>task</strong>는 다음 <strong>task</strong> 가 실행되기 전에 끝나게 됩니다. 즉, 각 작업이 현재 모든 상태를 완벽하게 제어 할 수 있다는 걸 의미하며, 동시적으로 간섭이 되는 걸 걱정할 필요가 없습니다.<br>
아래 예제를 확인해봅시다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="c1">// (A)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Second&#39;</span><span class="p">);</span>
<span class="p">},</span> <span class="mi">0</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;First&#39;</span><span class="p">);</span> <span class="c1">// (B)</span>
</code></pre></div>
<p>함수 (A) 라인이 시작되면 즉시 <strong>task queue</strong>에 추가 되지만, (B)라인 코드 조각 작업이 끝난 후에 실행되게 됩니다.<br>
즉 이 코드의 출력은 항상 다음과 같습니다.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">First
Second
</code></pre></div>
<h3>2-4 이벤트 루프 차단(Blocking the event loop)</h3>

<p>우리가 봤듯이 일부 탭(일부 브라우저에서, 전체 브라우저)은 싱글 프로세스로 운영됩니다. - 사용자 인터페이스, 모든 다른 연산작업들 포함하여.<br>
즉 해당 프로세스 안에서 엄청 긴 연산작업을 수행하게 하여 사용자 인터페이스를 멈추게 할 수 있다는 걸 의미합니다.<br>
아래 데모 코드를 확인해봅시다.</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;a</span> <span class="na">id=</span><span class="s">&quot;block&quot;</span> <span class="na">href=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>Block for 5 seconds<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;p&gt;</span>
<span class="nt">&lt;button&gt;</span>This is a button<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;statusMessage&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;script&gt;</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;block&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">onClick</span><span class="p">);</span>

    <span class="kd">function</span> <span class="nx">onClick</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

        <span class="nx">setStatusMessage</span><span class="p">(</span><span class="s1">&#39;Blocking...&#39;</span><span class="p">);</span>

        <span class="c1">// Call setTimeout(), so that browser has time to display</span>
        <span class="c1">// status message</span>
        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">sleep</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
            <span class="nx">setStatusMessage</span><span class="p">(</span><span class="s1">&#39;Done&#39;</span><span class="p">);</span>
        <span class="p">},</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">setStatusMessage</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;statusMessage&#39;</span><span class="p">).</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">sleep</span><span class="p">(</span><span class="nx">milliseconds</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">start</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
        <span class="k">while</span> <span class="p">((</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">milliseconds</span><span class="p">);</span>
    <span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div>
<blockquote>
<p>온라인에서 위 코드를 확인해보아요 <a href="http://rauschma.github.io/async-examples/blocking.html">링크</a></p>
</blockquote>

<p>코드 안에 <code>Block for 5 seconds</code>링크를 클릭하면 함수 <code>onClick()</code>이 트리거 되고, 5초 동안 <strong>event loop</strong>를 차단 하기 위하여 동기함수인 <code>sleep()</code>을 사용합니다. 이 시간 동안 사용자 인터페이스는 작동이 멈추게 됩니다. 예를 들어 당신은 “Simple button”을 클릭할 수 없을것 입니다.</p>

<h3>2-5 블로킹 피하기(Avoiding blocking)</h3>

<blockquote>
<p>다음 두 가지 방법으로 <strong>event loop</strong>를 차단하지 마십시오.</p>
</blockquote>

<p>첫 번째 당신은 메인 프로세스 안에서 엄청 긴 연산작업을 수행하면 안됩니다. 다른 프로세스로 옮겨야 합니다. <strong>Worker API</strong> 를 통해 수행할 수 있습니다.<br>
 두 번째 당신은 긴 연산 작업 결과를(동기적으로) 기다려서는 안 됩니다.(네트워크요청, 작업자 프로세스 안에 자신의 알고리즘 등)  <strong>event loop</strong>에서 수행시키고, 그 작업이 완료되면 통보를 하게 합니다. 사실 당신은 브라우저에서 이 작업을 하는 거에 대해 선택 여지가 없습니다. 예를 들어 내장된 동기 <code>sleep</code>(이전에 <code>sleep()</code>을 구현한 것 같은)이 없습니다. 대신에 <code>setTimeout()</code>으로 비동기적인 <code>sleep</code>을 수행할 수 있습니다.  </p>

<p>다음 섹션에서는 비동기 적으로 결과를 기다리는 기술에 대해 설명합니다.</p>

<h2>3. 비동기적 결과 수신(Receiving results asynchronously)</h2>

<blockquote>
<p>비동기적 결과를 수신하기 위한 2가지 패턴 : <strong>events</strong> 와 <strong>callback</strong></p>
</blockquote>

<h3>3-1 events를 통한 비동기 결과(Asynchronous results via events)</h3>

<p>결과를 비동기적으로 수신받기 위해서는, 각 요청 별 객체를 생성하고, 생성 객체와 함께 <strong>이벤트 핸들러</strong>(events handlers)를 등록합니다.(:하나는 성공적인 계산을위한 것이고 다른 하나는 오류를 처리하는 것입니다.)<br>
아래 코드는 <code>XMLHttpRequest</code> API가 어떻게 작동하는지 보여주는 코드입니다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">req</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span>

<span class="nx">req</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">processData</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">response</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ERROR&#39;</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">statusText</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">req</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Network Error&#39;</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">req</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span> <span class="c1">// Add request to task queue</span>
</code></pre></div>
<p>마지막 라인은 실제로 요청을 수행하지 않고, <strong>task queue</strong> 에 추가됩니다. 따라서, <code>onload</code> , <code>onerror</code> 가 세팅 되기 전에, <code>open()</code> 메서드를 후에 수행 할 수 있습니다. 자바스크립트 <strong>run-to-completion</strong> 때문에 동일하게 작동합니다.</p>

<h3>3-1-1 암시적 요청(Implicit requests)</h3>

<p>브라우저 API인 <strong>IndexedDB</strong>는 약간 특이한 스타일인 이벤트 처리(event handling)를 가지고 있습니다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">openRequest</span> <span class="o">=</span> <span class="nx">indexedDB</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="nx">openRequest</span><span class="p">.</span><span class="nx">onsuccess</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Success!&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">openRequest</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<p>첫 번째로 요청 객체를 만들고, 결과를 통지받기 위한 이벤트리스너를 등록합니다. 그러나 <code>open()</code>을 사용하여 요청을 명시적으로 <strong>queue</strong>에 추가 할 필요가 없습니다. 그것은 현재 <strong>task</strong>가 완료된 후에 실행됩니다. 그래서 <code>open()</code>을 호출 한 후 이벤트핸들러를 등록 할 수 있습니다.  </p>

<p>만약 당신이 <strong>멀티스레드</strong>(multi-thread)프로그래밍에 익숙하다면, 아마도 이 핸들링 요청 스타일은 낯설 것입니다. 그것은 마치 <strong>race condition</strong>(경쟁상태)와 같은 것처럼 보일 것입니다. 그러나 <strong>run-to-completion</strong> 때문에 항상 안전할 것입니다.</p>

<h3>3-1-2 events는 하나의 결과는 잘 작동하지 않습니다. (Events don’t work well for single results)</h3>

<p>만약 여러 번 결과를 수신받을 경우, 비동기 연산 결과 처리하는 것(handling)은 OK입니다. 그러나 단일 결과는 다음의 다변적인 문제를 일으킵니다. 그 사례로 콜백은 매우 인기가 많아지게 되었습니다.</p>

<h3>3-2 callbacks를 통한 비동기 결과(Asynchronous results via callbacks)</h3>

<p>만약 당신이 비동기 결과를 콜백을 통하여 처리 한다면, 비동기 함수 또는 메서드 호출에 후행 매개변수로 콜백 함수를 전달 합니다.  </p>

<p>아래 <strong>Node.js</strong> 예제를 봅시다. 우리는 <code>fs.readFile()</code>을 비동기로 호출하여 text 파일 내용을 읽습니다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Node.js</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="s1">&#39;myfile.txt&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">encoding</span><span class="o">:</span> <span class="s1">&#39;utf8&#39;</span> <span class="p">},</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">text</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// (A)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// ...</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
    <span class="p">});</span>
</code></pre></div>
<p>만약 <code>readFile()</code>이 성공하면 A라인 안에 <strong>text</strong> 파라미터를 통하여 결과를 수신받을 수 있습니다. 만약 성공하지 못하면 첫 번째 파라미터로 error를 받게 됩니다.</p>

<p>아래는 전통적인 함수형 프로그래밍 스타일로 만든 위 예제와 같은 코드입니다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Functional</span>
<span class="nx">readFileFunctional</span><span class="p">(</span><span class="s1">&#39;myfile.txt&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">encoding</span><span class="o">:</span> <span class="s1">&#39;utf8&#39;</span> <span class="p">},</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// success</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// failure</span>
        <span class="c1">// ...</span>
    <span class="p">});</span>
</code></pre></div>
<h3>3-3 Continuation-passing style(역자주: 고유명사 보통 CPS라고 불림)</h3>

<p>다음 단계 (연속)가 명시 적으로 매개 변수로 전달되기 때문에 콜백 사용 프로그래밍 스타일 (특히 앞에서 설명한 기능적 방식)은 <em>Continuation-passing-style</em>(CPS)라고 부릅니다.<br>
이렇게하면 호출 된 함수가 다음에 발생할 일을보다 잘 제어 할 수 있습니다.<br>
아래 <em>CPS</em>를 표현한 코드를 봅시다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">);</span>
<span class="nx">identity</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">step2</span><span class="p">(</span><span class="nx">result2</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result2</span><span class="p">);</span>
    <span class="nx">identity</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">step3</span><span class="p">(</span><span class="nx">result3</span><span class="p">)</span> <span class="p">{</span>
       <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result3</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">);</span>

<span class="c1">// Output: A E B D C</span>

<span class="kd">function</span> <span class="nx">identity</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">callback</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
    <span class="p">},</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>아래 각 절차는 콜백 안에서 프로그램이 진행하는 제어 흐름입니다. 이 중첩된 함수는 콜백지옥(callback hell)이라고 불리 웁니다. 그러나 당신은 중첩을 피할 수 있습니다. 왜냐하면 자바스크립트 함수는 호이스팅(hoisted:스코프 최상단으로 위치시키는 것을 의미함)하기 때문입니다. 이 말은 당신이 먼저 호출하고, 함수 정의는 나중에 한다는 걸 의미합니다. 아래 호이스팅을 사용한 예제를 확인해봅시다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">);</span>
<span class="nx">identity</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="nx">step2</span><span class="p">);</span>
<span class="kd">function</span> <span class="nx">step2</span><span class="p">(</span><span class="nx">result2</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// The program continues here</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result2</span><span class="p">);</span>
    <span class="nx">identity</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="nx">step3</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">step3</span><span class="p">(</span><span class="nx">result3</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result3</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">);</span>
</code></pre></div>
<p><a href="http://www.2ality.com/2012/06/continuation-passing-style.html">More information on CPS is given in [3]</a></p>

<h3>3-4 CPS 안에 코드 작성(Composing code in CPS)</h3>

<p>일반적인 자바스크립트 스타일은 코드 조각 들의 조합입니다.</p>

<ul>
<li>자바스크립트의 일반적인 코드가 사실은 &#39;조각들의 순차적인 조합&#39;이라는 것은 말할 필요 없이 명백하다. 하지만 다시 한 번 짚고 넘어가도 나쁠 건 없다.</li>
<li><code>map()</code>, <code>filter()</code>,<code>forEach()</code>와 같은 배열 메소드<br></li>
<li><code>for, while</code>과 같은 루프</li>
</ul>

<p><a href="https://github.com/caolan/async">Async.js</a> 라이브러리는 <strong>Node.js</strong> 콜백스타일과 함께 <strong>CPS</strong> 비슷한 것을 할 수 있게 제공합니다.<br>
그것은 아래 예제 코드와 같습니다. 3개의 파일의 컨텐츠를 불러오고 배열에 이름을 저장하는 예제 입니다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">async</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;async&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">fileNames</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;foo.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;bar.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;baz.txt&#39;</span> <span class="p">];</span>
<span class="nx">async</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">fileNames</span><span class="p">,</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">fileName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">fileName</span><span class="p">,</span> <span class="p">{</span> <span class="nx">encoding</span><span class="o">:</span> <span class="s1">&#39;utf8&#39;</span> <span class="p">},</span> <span class="nx">callback</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="c1">// Process the result</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">textArray</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;TEXTS:\n&#39;</span> <span class="o">+</span> <span class="nx">textArray</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n----\n&#39;</span><span class="p">));</span>
    <span class="p">});</span>
</code></pre></div>
<h3>3-5 콜백의 장단점(Pros and cons of callbacks)</h3>

<p>콜백을 사용하면 근본적으로 다른 프로그래밍 스타일 인 CPS가 발생합니다. CPS는 주요한 이점은 기본적인 메커니즘이 이해하기 쉽다는 것 입니다. 그러나 단점도 있습니다.</p>

<ul>
<li>에러 처리가 더 복잡해졌다: 에러를 처리하는 방법은 두 가지가 있다. 콜백 함수를 이용하는 방법과 예외를 이용하는 것 2가지가 있다. 그러므로 이 두 가지를 동시에 사용할 경우 조심해야 한다.</li>
<li>코드 직관성이 떨어진다: 동기 함수에서는 입력(매개변수)과 출력(함수 결과) 사이에 구분이 명확하다. 콜백을 사용하는 비동기 함수에서는 이 두 개가 섞여 있다. 함수의 매개변수 중 몇 개는 입력을 위해, 나머지는 출력을 위해 사용된다.</li>
<li>구성이 더 복잡해졌다: 출력을 위한 개념이 함수의 매개변수에 존재하기 때문에 구성이 더 복잡해졌다.</li>
</ul>

<p><strong>Node.js</strong> 콜백스타일은 3가지 단점을 가지고 있습니다.(함수 스타일과 비교)</p>

<ul>
<li>에러를 처리하기 위한 if문이 많다.</li>
<li>에러 핸들러를 재사용하기 힘들다.</li>
<li>또한, 기본 에러 핸들러를 제공하는 게 더 어렵다. 기본 에러 핸들러는 당신이 함수를 호출 할 때 자신만의 핸들러를 작성하지 않을 때 유용합니다. 또한 만약 호출자가 특정한 핸들러를 지정하지 않는다면 함수에 의해 사용될 수도 있다.</li>
</ul>

<h2>4. 다음에 할 내용(Looking ahead)</h2>

<p>다음 챕터는 <strong>Promise</strong>와 <strong>ES6 Promise</strong> API을 다룹니다. <strong>Promise</strong>는 콜백보다 더 복잡합니다. 중요한 이점을 제공함으로써 콜백의 단점을 제거합니다.</p>

<h2>5. 추가로 읽을 거리(Further reading)</h2>

<ul>
<li>[1] “<a href="http://vimeo.com/96425312">Help i’m stuck in an event-loop</a>” by Philip Roberts (video).</li>
<li>[2] “<a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loops">Event loops</a>” in the HTML Specification</li>
<li>[3] “<a href="http://www.2ality.com/2012/06/continuation-passing-style.html">Asynchronous programming and continuation-passing style in JavaScript</a>” by Axel Rauschmayer.</li>
</ul>

        </div>

        <div class="media_content media_item shadow_panel">
            <p>Tags : <a href="/tags/javascript">javascript</a>&nbsp;<a href="/tags/es6">es6</a>&nbsp;<a href="/tags/asynchronous">asynchronous</a>&nbsp;</p>
        </div>


        <div class="media_content media_item shadow_panel">
            <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'html5krforkisa'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
        </div>

    </div>

    <script>
        $('#main_content').toc();
    </script>
</div>
<footer>
<table width="100%" height="80" class="footer">
    <tr>
        <td align="center" class="footer_content">
            WebFrameworks.kr @since 2015
        </td>
    </tr>
</table>
</footer>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-56520981-1', 'auto');
    ga('send', 'pageview');

</script>
</body>
</html>