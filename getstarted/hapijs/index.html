<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<style>
@import url(https://fonts.googleapis.com/earlyaccess/nanumgothic.css); /* 나눔고딕 : 'Nanum Gothic' */
</style>
<title>WebFrameworks.kr - Hapi.js</title>
<link rel="stylesheet" href="/static/css/bootstrap.min.css">
<link rel="stylesheet" href="/static/css/main.css">
<link rel="stylesheet" href="/static/css/syntax.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="/static/css/toc.css">
    <script type="text/javascript" src="/static/js/jquery.toc.js"></script>
    <style>
        #toc_location.affix {
            top:50px;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-default top_menu" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">웹Frameworks</a>
        </div>

        <div class="collapse navbar-collapse" id="navbar-collapse-1">
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/getstarted">Get Started</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/updates">Update</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/tutorials">Tutorials</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/quickstart">Quick Start</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="/archives">Archives</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="https://github.com/KoreaHTML5/webframeworks.kr/blob/master/CONTRIBUTE.md" target="_blank">참여하기</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
                <li><a href="http://goo.gl/forms/MB9ZxVvdrD" target="_blank">설문하기</a></li>
            </ul>
        </div>
    </div>
</nav>


<div class="content_bg"  style="background-color: #f6941e;color: #444444;" >
    <div class="col-md-10 col-md-offset-1 title_header jumbotron"  style="background:url() no-repeat center"  >
        <h1 class="title_header_title">Hapi.js</h1>
        <p class="title_header_summary">Hapi.js는 노드로 구현한 웹프레임웍 입니다. Hapi.js의 구조와 사용법에 대해 알아봅니다.</p>
    </div>
</div>

<div>

    <div class="col-sm-3 col-md-2 col-md-offset-2">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">작성자</h3>
            </div>
            <div class="panel-body">
                <div class="media">
                    <a class="pull-left" href="#">
                        <img class="media-object profile_img" src="https://avatars0.githubusercontent.com/u/1788964?v=3&s=460" alt="김정환">
                    </a>
                    <div class="media-body">
                        <h4 class="media-heading">
                            김정환

                        </h4>
                        jeonghwan-kim<br>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">Tags</h3>
    </div>
    <div class="panel-body">
        <a href='/tags/jquery/' style='color: rgba(0,0,0,0.059259)'>jquery</a>
<a href='/tags/javascript/' style='color: rgba(0,0,0,10.725926)'>javascript</a>
<a href='/tags/html/' style='color: rgba(0,0,0,0.059259)'>html</a>
<a href='/tags/grunt/' style='color: rgba(0,0,0,0.059259)'>grunt</a>
<a href='/tags/gulp/' style='color: rgba(0,0,0,0.059259)'>gulp</a>
<a href='/tags/build/' style='color: rgba(0,0,0,0.355556)'>build</a>
<a href='/tags/yeoman/' style='color: rgba(0,0,0,0.059259)'>yeoman</a>
<a href='/tags/foundation/' style='color: rgba(0,0,0,0.059259)'>foundation</a>
<a href='/tags/bower/' style='color: rgba(0,0,0,0.118519)'>bower</a>
<a href='/tags/twitter/' style='color: rgba(0,0,0,0.118519)'>twitter</a>
<a href='/tags/framework/' style='color: rgba(0,0,0,2.429630)'>framework</a>
<a href='/tags/angularjs/' style='color: rgba(0,0,0,1.007407)'>angularjs</a>
<a href='/tags/tutorials/' style='color: rgba(0,0,0,1.303704)'>tutorials</a>
<a href='/tags/backbone/' style='color: rgba(0,0,0,0.237037)'>backbone</a>
<a href='/tags/getstarted/' style='color: rgba(0,0,0,0.177778)'>getstarted</a>
<a href='/tags/underscore/' style='color: rgba(0,0,0,0.059259)'>underscore</a>
<a href='/tags/library/' style='color: rgba(0,0,0,0.414815)'>library</a>
<a href='/tags/Ext/' style='color: rgba(0,0,0,0.533333)'>Ext</a>
<a href='/tags/JS/' style='color: rgba(0,0,0,0.829630)'>JS</a>
<a href='/tags/tutorial/' style='color: rgba(0,0,0,0.770370)'>tutorial</a>
<a href='/tags/modernizr/' style='color: rgba(0,0,0,0.059259)'>modernizr</a>
<a href='/tags/bootstrap/' style='color: rgba(0,0,0,0.177778)'>bootstrap</a>
<a href='/tags/quickstart/' style='color: rgba(0,0,0,0.059259)'>quickstart</a>
<a href='/tags/angular-di/' style='color: rgba(0,0,0,0.059259)'>angular-di</a>
<a href='/tags/animation/' style='color: rgba(0,0,0,0.237037)'>animation</a>
<a href='/tags/router/' style='color: rgba(0,0,0,0.059259)'>router</a>
<a href='/tags/promise/' style='color: rgba(0,0,0,0.296296)'>promise</a>
<a href='/tags/responsive/' style='color: rgba(0,0,0,0.059259)'>responsive</a>
<a href='/tags/form/' style='color: rgba(0,0,0,0.118519)'>form</a>
<a href='/tags/validation/' style='color: rgba(0,0,0,0.118519)'>validation</a>
<a href='/tags/map/' style='color: rgba(0,0,0,0.059259)'>map</a>
<a href='/tags/direcitve/' style='color: rgba(0,0,0,0.059259)'>direcitve</a>
<a href='/tags/file/' style='color: rgba(0,0,0,0.118519)'>file</a>
<a href='/tags/test/' style='color: rgba(0,0,0,0.237037)'>test</a>
<a href='/tags/ui-bootstrap/' style='color: rgba(0,0,0,0.059259)'>ui-bootstrap</a>
<a href='/tags/twitter-bootstrap/' style='color: rgba(0,0,0,0.059259)'>twitter-bootstrap</a>
<a href='/tags/d3.js/' style='color: rgba(0,0,0,0.059259)'>d3.js</a>
<a href='/tags/visualization/' style='color: rgba(0,0,0,0.355556)'>visualization</a>
<a href='/tags/expressjs/' style='color: rgba(0,0,0,0.414815)'>expressjs</a>
<a href='/tags/react/' style='color: rgba(0,0,0,1.777778)'>react</a>
<a href='/tags/session/' style='color: rgba(0,0,0,0.177778)'>session</a>
<a href='/tags/meteor/' style='color: rgba(0,0,0,0.829630)'>meteor</a>
<a href='/tags/SEO/' style='color: rgba(0,0,0,0.059259)'>SEO</a>
<a href='/tags/REST/' style='color: rgba(0,0,0,0.059259)'>REST</a>
<a href='/tags/API/' style='color: rgba(0,0,0,0.059259)'>API</a>
<a href='/tags/es2015/' style='color: rgba(0,0,0,0.118519)'>es2015</a>
<a href='/tags/es6/' style='color: rgba(0,0,0,0.651852)'>es6</a>
<a href='/tags/es7/' style='color: rgba(0,0,0,0.118519)'>es7</a>
<a href='/tags/DDP/' style='color: rgba(0,0,0,0.059259)'>DDP</a>
<a href='/tags/ngMessages/' style='color: rgba(0,0,0,0.118519)'>ngMessages</a>
<a href='/tags/jsx/' style='color: rgba(0,0,0,0.059259)'>jsx</a>
<a href='/tags/publish/' style='color: rgba(0,0,0,0.059259)'>publish</a>
<a href='/tags/subscribe/' style='color: rgba(0,0,0,0.059259)'>subscribe</a>
<a href='/tags/meteor.js/' style='color: rgba(0,0,0,0.059259)'>meteor.js</a>
<a href='/tags/node.js/' style='color: rgba(0,0,0,0.237037)'>node.js</a>
<a href='/tags/backend/' style='color: rgba(0,0,0,0.177778)'>backend</a>
<a href='/tags/reactive/' style='color: rgba(0,0,0,0.059259)'>reactive</a>
<a href='/tags/package/' style='color: rgba(0,0,0,0.059259)'>package</a>
<a href='/tags/static/' style='color: rgba(0,0,0,0.059259)'>static</a>
<a href='/tags/assets/' style='color: rgba(0,0,0,0.059259)'>assets</a>
<a href='/tags/public/' style='color: rgba(0,0,0,0.059259)'>public</a>
<a href='/tags/flux/' style='color: rgba(0,0,0,0.237037)'>flux</a>
<a href='/tags/redux/' style='color: rgba(0,0,0,0.414815)'>redux</a>
<a href='/tags/server/' style='color: rgba(0,0,0,0.059259)'>server</a>
<a href='/tags/distribution/' style='color: rgba(0,0,0,0.059259)'>distribution</a>
<a href='/tags/webpack/' style='color: rgba(0,0,0,0.177778)'>webpack</a>
<a href='/tags/development/' style='color: rgba(0,0,0,0.059259)'>development</a>
<a href='/tags/optimization/' style='color: rgba(0,0,0,0.059259)'>optimization</a>
<a href='/tags/immutable/' style='color: rgba(0,0,0,0.059259)'>immutable</a>
<a href='/tags/orm/' style='color: rgba(0,0,0,0.237037)'>orm</a>
<a href='/tags/database/' style='color: rgba(0,0,0,0.237037)'>database</a>
<a href='/tags/hapi.js/' style='color: rgba(0,0,0,0.059259)'>hapi.js</a>
<a href='/tags/hapi/' style='color: rgba(0,0,0,0.237037)'>hapi</a>
<a href='/tags/ionic/' style='color: rgba(0,0,0,0.118519)'>ionic</a>
<a href='/tags/hybrid-app/' style='color: rgba(0,0,0,0.059259)'>hybrid-app</a>
<a href='/tags/django/' style='color: rgba(0,0,0,0.059259)'>django</a>
<a href='/tags/fullstack/' style='color: rgba(0,0,0,0.059259)'>fullstack</a>
<a href='/tags/spa/' style='color: rgba(0,0,0,0.059259)'>spa</a>
<a href='/tags/ExpressJS/' style='color: rgba(0,0,0,0.296296)'>ExpressJS</a>
<a href='/tags/NodeJS/' style='color: rgba(0,0,0,0.296296)'>NodeJS</a>
<a href='/tags/Sequelize/' style='color: rgba(0,0,0,0.296296)'>Sequelize</a>
<a href='/tags/Mocha/' style='color: rgba(0,0,0,0.296296)'>Mocha</a>
<a href='/tags/Supertest/' style='color: rgba(0,0,0,0.296296)'>Supertest</a>
<a href='/tags/UnitTest/' style='color: rgba(0,0,0,0.296296)'>UnitTest</a>
<a href='/tags/reactjs/' style='color: rgba(0,0,0,0.118519)'>reactjs</a>
<a href='/tags/this/' style='color: rgba(0,0,0,0.118519)'>this</a>
<a href='/tags/dom/' style='color: rgba(0,0,0,0.059259)'>dom</a>
<a href='/tags/es5/' style='color: rgba(0,0,0,0.118519)'>es5</a>
<a href='/tags/virtualdom/' style='color: rgba(0,0,0,0.118519)'>virtualdom</a>
<a href='/tags/modules/' style='color: rgba(0,0,0,0.059259)'>modules</a>
<a href='/tags/asynchronous/' style='color: rgba(0,0,0,0.059259)'>asynchronous</a>
<a href='/tags/semicolon/' style='color: rgba(0,0,0,0.059259)'>semicolon</a>
<a href='/tags/nodejs/' style='color: rgba(0,0,0,0.118519)'>nodejs</a>
<a href='/tags/ECMAScript2015/' style='color: rgba(0,0,0,0.118519)'>ECMAScript2015</a>
<a href='/tags/babel/' style='color: rgba(0,0,0,0.059259)'>babel</a>
<a href='/tags/angular,/' style='color: rgba(0,0,0,0.059259)'>angular,</a>
<a href='/tags/electron/' style='color: rgba(0,0,0,0.118519)'>electron</a>
<a href='/tags/docker/' style='color: rgba(0,0,0,0.474074)'>docker</a>
<a href='/tags/D3/' style='color: rgba(0,0,0,0.059259)'>D3</a>
<a href='/tags/node/' style='color: rgba(0,0,0,0.118519)'>node</a>
<a href='/tags/express/' style='color: rgba(0,0,0,0.118519)'>express</a>
<a href='/tags/aws/' style='color: rgba(0,0,0,1.600000)'>aws</a>
<a href='/tags/dynamoDB/' style='color: rgba(0,0,0,0.059259)'>dynamoDB</a>
<a href='/tags/chrome/' style='color: rgba(0,0,0,0.059259)'>chrome</a>
<a href='/tags/native/' style='color: rgba(0,0,0,0.118519)'>native</a>
<a href='/tags/markdown/' style='color: rgba(0,0,0,0.059259)'>markdown</a>
<a href='/tags/vue/' style='color: rgba(0,0,0,2.192593)'>vue</a>
<a href='/tags/middleware/' style='color: rgba(0,0,0,0.118519)'>middleware</a>
<a href='/tags/IoT/' style='color: rgba(0,0,0,0.059259)'>IoT</a>
<a href='/tags/serverless/' style='color: rgba(0,0,0,0.533333)'>serverless</a>
<a href='/tags/python/' style='color: rgba(0,0,0,0.177778)'>python</a>
<a href='/tags/socket.io/' style='color: rgba(0,0,0,0.177778)'>socket.io</a>
<a href='/tags/typescript/' style='color: rgba(0,0,0,0.059259)'>typescript</a>
<a href='/tags/laravel/' style='color: rgba(0,0,0,1.540741)'>laravel</a>
<a href='/tags/express.js/' style='color: rgba(0,0,0,0.059259)'>express.js</a>
<a href='/tags/github/' style='color: rgba(0,0,0,0.118519)'>github</a>
<a href='/tags/slack/' style='color: rgba(0,0,0,0.118519)'>slack</a>
<a href='/tags/react-native/' style='color: rgba(0,0,0,0.059259)'>react-native</a>
<a href='/tags/data/' style='color: rgba(0,0,0,0.296296)'>data</a>
<a href='/tags/opensource/' style='color: rgba(0,0,0,0.059259)'>opensource</a>
<a href='/tags/pwa/' style='color: rgba(0,0,0,0.059259)'>pwa</a>
<a href='/tags/php/' style='color: rgba(0,0,0,0.059259)'>php</a>
<a href='/tags/vuejs/' style='color: rgba(0,0,0,0.592593)'>vuejs</a>
<a href='/tags/nextjs/' style='color: rgba(0,0,0,0.474074)'>nextjs</a>
<a href='/tags/react_admin/' style='color: rgba(0,0,0,0.177778)'>react_admin</a>
<a href='/tags/cd/' style='color: rgba(0,0,0,0.059259)'>cd</a>
<a href='/tags/webrtc/' style='color: rgba(0,0,0,0.237037)'>webrtc</a>
<a href='/tags/pm2/' style='color: rgba(0,0,0,0.059259)'>pm2</a>
<a href='/tags/docker_registry/' style='color: rgba(0,0,0,0.059259)'>docker_registry</a>
<a href='/tags/ecr/' style='color: rgba(0,0,0,0.059259)'>ecr</a>
<a href='/tags/twilio/' style='color: rgba(0,0,0,0.059259)'>twilio</a>
<a href='/tags/json_schema/' style='color: rgba(0,0,0,0.059259)'>json_schema</a>
<a href='/tags/sql/' style='color: rgba(0,0,0,0.059259)'>sql</a>
<a href='/tags/json/' style='color: rgba(0,0,0,0.059259)'>json</a>
<a href='/tags/web/' style='color: rgba(0,0,0,0.059259)'>web</a>
<a href='/tags/sdk/' style='color: rgba(0,0,0,0.059259)'>sdk</a>
<a href='/tags/ssl/' style='color: rgba(0,0,0,0.059259)'>ssl</a>
<a href='/tags/portainer/' style='color: rgba(0,0,0,0.059259)'>portainer</a>
<a href='/tags/jwt/' style='color: rgba(0,0,0,0.059259)'>jwt</a>
<a href='/tags/mailu/' style='color: rgba(0,0,0,0.059259)'>mailu</a>
<a href='/tags/sam/' style='color: rgba(0,0,0,0.059259)'>sam</a>
<a href='/tags/lambda/' style='color: rgba(0,0,0,0.059259)'>lambda</a>
<a href='/tags/thumbnail/' style='color: rgba(0,0,0,0.059259)'>thumbnail</a>
<a href='/tags/redis/' style='color: rgba(0,0,0,0.059259)'>redis</a>

    </div>
</div>

        <div id="toc_location" style="z-index:99999;"></div>

    </div>

    <div class="col-sm-9 col-md-6">
        <div class="media_content media_item shadow_panel" id="main_content">
            <h1>Hapi.js 시작하기</h1>

<p>Node.js에서 서버 구현은 대부분 Express.js 프레임웍으로 개발했다. 
Express.js 3.x에서 4.x대로 업그레이드 되면서 개선된 성능과 사용 편의성에서 만족하고 있었다. 
이제 막 익스프레스 프레임웍이 손에 익을 무렵 <a href="http://hapijs.com/">Hapi</a>라는 신규 노드 프레임웍에 대한 글을 접한게 되었다. </p>

<p>Hapi를 스터디한 동기는 코드의 간결함이다. 
<a href="http://hapijs.com/tutorials#creating-a-server">튜터리얼</a>에 보면 단 네 문장으로 서버를 설정하고 구동할수 있다. 
익스프레스 보다는 코드가 간결하고 모듈화하기 쉽다는 것을 실감한다. 
라우팅을 별도로 모듈화할 수 있다는 점, 프로토콜 파라메터 검증이 용이한 점(Joi), 로깅(Good) 등.</p>

<h2>Hello World</h2>

<p>아래 코드를 보자.  (index.js)</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;hapi&#39;</span><span class="p">);</span>

<span class="c1">// 서버 객체 생성 및 컨넥션 정보 설정</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">();</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">connection</span><span class="p">({</span>
    <span class="nx">host</span><span class="o">:</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
    <span class="nx">port</span><span class="o">:</span> <span class="mi">8000</span>
<span class="p">});</span>

<span class="c1">// 라우팅 설정 (&#39;/&#39;)</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
    <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
    <span class="nx">path</span><span class="o">:</span><span class="s1">&#39;/&#39;</span><span class="p">,</span>
    <span class="nx">handler</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">reply</span><span class="p">(</span><span class="s1">&#39;server is running&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// 서버 구동</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hello, hapi server is running in &#39;</span> <span class="o">+</span> <span class="nx">server</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">uri</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>홈페이지에 나온 샘플 코드다. 
코드만 봐도 &#39;나는 Api 서버를 구현하는 놈이요&#39;라는 걸 알수 있다. 
서버 객체를 생성하고 바로 라우팅 설정 후 서버를 구동한다. 
이후에 할것은 Api 서버의 목적에 맞게 필요한 프로토콜을 <code>route()</code> 함수로 추가하는 일이다.</p>

<h2>라우팅</h2>

<p>라우팅을 좀 더 살펴보자. 
server객체의 <code>route()</code> 함수로 라우팅을 설정한다. 
<code>method</code>에 &#39;GET&#39;, &#39;POST&#39;, &#39;PUT&#39;, &#39;DELTE&#39;를 설정하고 <code>path</code>에 라우팅 경로를 설정한다. 
그리고 <code>handler</code>에 라우팅 로직 함수를 연결한다. 
핸들러 함수는 두 파라매터를 받는데 첫번째 <code>req</code> 변수가 프로토콜 요청에 대한 정보를 담는 객체다. 
이 리퀘스트 객체를 통해 파라매터 등을 받아 비지니스 로직을 처리하면 된다.  
파라매터는 세 가지 형식으로 받는다.</p>

<ul>
<li><code>req.params</code>: url의 리소스 구분자(&#39;/&#39;)분을 통해 입력받은 값, 예( /users/Chris일 경우 Chris를 입력받을수 있음)</li>
<li><code>req.query</code>: 쿼리스트링으로 입력받은 값 (보통 GET 메소드를 통해 얻는 파라매터)</li>
<li><code>req.payload</code>: POST 메소드를 통해 얻는 리퀘스트 바디 데이터 </li>
</ul>

<p>다음 포스트에서 설명하겠지만 Hapi는 리퀘스트 객체를 통해 얻는 파라매터를 검증하는 강력한 모듈 <a href="https://github.com/hapijs/joi">Joi</a>를 제공한다.</p>

<p>두 번째 파라매터 <code>reply</code> 객체는 비지니스 로직 처리후 클라이언트 응답을 위해 사용한다. 
파라메터로 문자열을 넣으면 Plane Text를, 자바스크립트 객체를 넘겨주면 Json형식으로 반환한다. 
<code>reply.code()</code>로 http 상태코드를 보낼 수도 있다. 
함수 체이닝을 이용해 <code>reply().code()</code>로 사용할 수도 있다.</p>

<p>라우팅 설정을 server객체의 route() 함수가 담당하므로 server 객체를 넘겨주면 라우팅 모듈만 별도로 분리할 수 있다. 
모듈화를 위해 reoutes.js라는 파일로 라운팅을 분리하자.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// index.js</span>
<span class="kd">var</span> <span class="nx">Hapi</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;hapi&#39;</span><span class="p">);</span>

<span class="c1">// 서버 객체 생성 및 컨넥션 정보 설정</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hapi</span><span class="p">.</span><span class="nx">Server</span><span class="p">();</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">connection</span><span class="p">({</span>
    <span class="nx">host</span><span class="o">:</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
    <span class="nx">port</span><span class="o">:</span> <span class="mi">8000</span>
<span class="p">});</span>

<span class="c1">// 라우팅 설정 (&#39;/&#39;)</span>
<span class="nx">require</span><span class="p">(</span><span class="s1">&#39;routes.js&#39;</span><span class="p">)(</span><span class="nx">server</span><span class="p">);</span>

<span class="c1">// 서버 구동</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hello, hapi server is running in &#39;</span> <span class="o">+</span> <span class="nx">server</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">uri</span><span class="p">);</span>
<span class="p">});</span>


<span class="c1">// routes.js </span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">server</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
        <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
        <span class="nx">path</span><span class="o">:</span><span class="s1">&#39;/&#39;</span><span class="p">,</span>
        <span class="nx">handler</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">reply</span><span class="p">(</span><span class="s1">&#39;server is running&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">server</span><span class="p">.</span><span class="nx">route</span><span class="p">({</span>
        <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
        <span class="nx">path</span><span class="o">:</span><span class="s1">&#39;/hello/{name}&#39;</span><span class="p">,</span>
        <span class="nx">handler</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">reply</span><span class="p">(</span><span class="s1">&#39;hello &#39;</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>

<span class="p">};</span>
</code></pre></div>
<p>기존 index.js 파일에서는 라우팅 모듈을 불러와서 server 객체를 넘겨준다. 
routes.js 모듈에서는 이 server객체를 이용하여 라우팅 설정을 한다.</p>

<h2>라우팅 모듈화</h2>

<p>좀 더 확장해 보면 리소스명으로 폴더를 만들고 각 폴더에 server 객체를 받는 라우팅 모듈을 구현할 수 있다. 
기존 index.js 는 라우팅 설정만 변경한다. 
모듈을 분리한 routes/index.js 파일을 불러와서 server 객체를 넘겨 준다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// 서버 객체 생성 및 컨넥션 정보 설정 ...</span>

<span class="c1">// 라우팅 설정 (&#39;/&#39;)</span>
<span class="nx">require</span><span class="p">(</span><span class="s1">&#39;routes&#39;</span><span class="p">)(</span><span class="nx">server</span><span class="p">);</span>

<span class="c1">// 서버 구동 ...</span>
</code></pre></div>
<p>routes/index.js에서는 index.js에서 넘겨받은 server 객체를 이용해 하위 라우팅을 위해 다시 server 객체를 전달한다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">server</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// 각 폴더에 라우팅을 위해 server 객체를 넘겨줌</span>
    <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)(</span><span class="nx">server</span><span class="p">);</span>
    <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">)(</span><span class="nx">server</span><span class="p">);</span>
    <span class="c1">// ...</span>
<span class="p">};</span>
</code></pre></div>
<p>리소스 단위로 만든 routes 하위폴더에 각 각 index.js 파일을 만들고 넘겨받은 server 객체를 통해 라우팅 설정을 한다. 
만약 하위 리스소를 가지고 있다면 동일하게 server 객체를 넘겨준다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">server</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// 라우팅 설정 ...</span>

    <span class="c1">// 하위 라우팅을 위해 하위 폴더에 server 객체를 넘김 </span>
    <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;users 하위폴더1&#39;</span><span class="p">)(</span><span class="nx">server</span><span class="p">);</span>
    <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;users 하위폴더2&#39;</span><span class="p">)(</span><span class="nx">server</span><span class="p">);</span>
    <span class="c1">// ...</span>

<span class="p">};</span>
</code></pre></div>
<h2>라우팅 헬퍼</h2>

<p>지금까지 코드를 보면 폴더별로 하위 폴더에 대한 라우팅을 위해 server 객체를 넘기는 코드가 중복이다. 
이 부분을 routeHelper 모듈로 분리해 보자.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// reouteHelper.js</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">route</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">server</span><span class="p">,</span> <span class="nx">_path</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">server</span> <span class="o">||</span> <span class="o">!</span><span class="nx">_path</span><span class="p">)</span> <span class="k">throw</span> <span class="nb">Error</span><span class="p">();</span>

  <span class="nx">fs</span><span class="p">.</span><span class="nx">readdirSync</span><span class="p">(</span><span class="nx">_path</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">dir</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Ignore files. Only folders</span>
    <span class="k">if</span> <span class="p">(</span><span class="sr">/.js/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">dir</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>

    <span class="nx">require</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">_path</span><span class="p">,</span>  <span class="nx">dir</span><span class="p">))(</span><span class="nx">server</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span>
</code></pre></div>
<p>server 객체를 첫번째 파라매터로 받고, 두번째 파라매터인 <code>_path</code>에 호출 측 경로를 전달 받는다. 
이것을 통해 하위 폴더에 라우팅을 위한 server 객체를 전달할 수 있다. 
아래는 routeHelper로 대체한 코드다.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// index.js</span>
<span class="c1">// 서버 객체 생성 및 컨넥션 정보 설정 ...</span>

<span class="c1">// 라우팅 설정 (&#39;/&#39;)</span>
<span class="nx">require</span><span class="p">(</span><span class="s1">&#39;routes&#39;</span><span class="p">)(</span><span class="nx">server</span><span class="p">);</span>

<span class="c1">// 서버 구동 ...</span>


<span class="c1">// routes/index.js </span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">server</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// 각 폴더에 라우팅을 위해 server 객체를 넘겨줌</span>
    <span class="nx">routeHelper</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="nx">server</span><span class="p">,</span> <span class="nx">__dirname</span><span class="p">);</span>
<span class="p">};</span>


<span class="c1">// routes/users/index.js </span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">server</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// 라우팅 설정</span>

    <span class="c1">// 하위 라우팅을 위해 하위 폴더에 server 객체를 넘김 </span>
    <span class="nx">routeHelper</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="nx">server</span><span class="p">,</span> <span class="nx">__dirname</span><span class="p">);</span>
<span class="p">};</span>


<span class="c1">// routes/posts/index.js </span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">server</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 라우팅 설정 ...</span>

    <span class="c1">// 하위 라우팅을 위해 하위 폴더에 server 객체를 넘김</span>
    <span class="nx">routeHelper</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="nx">server</span><span class="p">,</span> <span class="nx">__dirname</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
        </div>

        <div class="media_content media_item shadow_panel">
            <p>Tags : <a href="/tags/hapi.js">hapi.js</a>&nbsp;<a href="/tags/node.js">node.js</a>&nbsp;<a href="/tags/backend">backend</a>&nbsp;<a href="/tags/javascript">javascript</a>&nbsp;<a href="/tags/library">library</a>&nbsp;</p>
        </div>


        <div class="media_content media_item shadow_panel">
            <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'html5krforkisa'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
        </div>

    </div>


    <script>
        $('#main_content').toc();

        $(document).ready(function(){
            $('#toc_location').affix({
                offset:{
                    top: function(){
                        return 550;
                    }
                }
            });
        })
    </script>
</div>
<footer>
<table width="100%" height="80" class="footer">
    <tr>
        <td align="center" class="footer_content">
            WebFrameworks.kr @since 2015
        </td>
    </tr>
</table>
</footer>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-56520981-1', 'auto');
    ga('send', 'pageview');

</script>
</body>
</html>